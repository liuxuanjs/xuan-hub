
### 1. 子应用独立开发机制

我们设计了一套完整的子应用独立开发联调机制，这是项目的一个技术亮点：

```json
// 子应用通过主应用npm包进行联调
{
  "generateHTML:business": "node node_modules/@shuyun-ep-team/portal/generate-html.js --configPath ./app.config.js",
  "generateHTML:implement": "node node_modules/@shuyun-ep-team/loktar-portal/generate-html.js --configPath ./app.config.js"
}
```

### 子应用开发流程

```typescript
// 1. 子应用安装主应用npm包作为依赖
npm install @shuyun-ep-team/portal

// 2. 配置app.config.js模拟环境
module.exports = {
  CCMS_INFOS_CONFIG: {
    TENANT: 'vl7y8cbe33',
    UAL: 'https://ual-test.kylin.shuyun.com',
    SAAS: 'false'
  }
};

// 3. 生成包含配置的HTML文件
npm run generateHTML:business

// 4. 主应用识别开发模式，使用本地配置
if (process.env.isForAppDevCI) {
  // 使用window.CCMS_INFOS_CONFIG本地配置
  setItem('CCMS_INFOS_CONFIG', window.CCMS_INFOS_CONFIG);
} else {
  // 生产环境从API获取配置
  await SystemStore.fetchConfigAndSetCCMSConfigScript();
}
```

### 技术实现细节

```typescript
// generate-html.js 将配置注入到HTML中
function generateScriptText(config) {
  return Object.keys(config)
    .map((key) => {
      const content = JSON.stringify(config[key], null, 2);
      return `\nwindow.${key} = ${content};\n`;
    })
    .join('');
}
```

### 这种机制的优势

- ✅ **完全解耦** - 子应用无需依赖主应用运行环境
- ✅ **版本管控** - 通过 npm 包版本管理主应用能力
- ✅ **配置灵活** - 不同环境使用不同的 app.config.js
- ✅ **开发高效** - 子应用团队可以并行独立开发

### 2. 共享组件和服务

```typescript
// Common Package 提供统一的基础能力
export const PortalService = {
  ThemeService, // 主题服务
  LanguageService, // 国际化服务
  AuthService, // 认证服务
  BreadcrumbService, // 面包屑服务
};
```

**共享策略：**

- 基础组件库统一维护
- 业务组件按需共享
- 工具函数集中管理

### 3. 标准化开发规范

```typescript
// 子应用入口标准
export function bootstrap(config) {
  /* 标准化初始化 */
}
export function mount(config) {
  /* 标准化挂载 */
}
export function unmount(config) {
  /* 标准化卸载 */
}
```

**规范内容：**

- 代码风格和格式规范
- 组件开发规范
- API 接口规范
- 测试覆盖率要求

### 4. 统一构建和发布

```json
{
  "scripts": {
    "build:all": "lerna run build",
    "test:all": "lerna run test",
    "publish:all": "lerna publish"
  }
}
```

**发布流程：**

1. **代码检查** - ESLint + TypeScript 检查
2. **单元测试** - Jest 自动化测试
3. **构建打包** - Webpack 多环境构建
4. **版本发布** - Lerna 版本管理和发布

### 5. 开发工具链

```typescript
// 开发环境配置
const devConfig = {
  // 热更新配置
  devServer: {
    hot: true,
    port: 3000,
    proxy: {
      '/api': 'http://localhost:8080',
    },
  },

  // 开发工具
  devtool: 'eval-source-map',

  // 模拟数据
  before(app) {
    app.use('/mock', mockMiddleware);
  },
};
```

### 6. 协作效率提升数据

| 协作指标       | 改进前   | 改进后   | 提升幅度 |
| -------------- | -------- | -------- | -------- |
| 并行开发能力   | 2 个团队 | 5 个团队 | 150% ↑   |
| 新功能开发周期 | 2 周     | 1 周     | 50% ↓    |
| 代码冲突频率   | 15 次/周 | 3 次/周  | 80% ↓    |
| 部署频率       | 1 次/周  | 3 次/周  | 200% ↑   |

### 7. 质量保障机制

```typescript
// 自动化测试
describe('微前端应用', () => {
  test('应用正常加载', async () => {
    const app = await loadApp('business-app');
    expect(app).toBeDefined();
  });

  test('应用通信正常', () => {
    const service = window.KyPortalService;
    expect(service.ThemeService).toBeDefined();
  });
});
```

**质量体系：**

- 单元测试覆盖率 > 80%
- 集成测试自动化
- 性能监控和告警
- 代码审查机制

### 8. 知识共享和培训

- **技术分享会** - 定期分享最佳实践
- **文档维护** - 完善的开发文档
- **Code Review** - 代码审查促进知识传播
- **新人培训** - 标准化的入门培训

[← 上一个问题：性能优化策略](06-如何保证微前端应用的性能.md) | [下一个问题：技术栈兼容性 →](08-如何处理不同技术栈的兼容性问题.md)
