MobX 是一个简单、可扩展的状态管理库，它通过透明的函数响应式编程 (Transparent Functional Reactive Programming，TFRP) 使得状态管理变得简单和可扩展。


## 什么是 MobX？

MobX 是一个 JavaScript 状态管理库，它使得在严格的函数式编程环境中管理状态变得简单和可扩展。MobX 的目标是使得状态管理简单、无忧，并且可以在任何地方使用。

MobX 的主要特性包括：

- **透明的函数响应式编程**：MobX 会自动追踪你的代码中的状态变化，并且在需要的时候自动更新 UI。
- **最小化状态**：MobX 使得你可以只关注最小的状态，而不是大的、复杂的状态树。
- **可扩展**：MobX 可以用于管理简单的 UI 状态，也可以用于构建复杂的数据模型。

## 概念

MobX 区分了以下几个应用中的概念。

### 1. State(状态)

**状态** 是驱动应用的数据。 通常有像待办事项列表这样的**领域特定状态**，还有像当前已选元素的**视图状态**。 记住，状态就像是有数据的excel表格。

###  2. Derivations(衍生)

**任何** 源自**状态**并且不会再有任何进一步的相互作用的东西就是衍生。 衍生以多种形式存在:

- **用户界面**
- **衍生数据**，比如剩下的待办事项的数量。
- **后端集成**，比如把变化发送到服务器端。

MobX 区分了两种类型的衍生:

- **Computed values(计算值)** - 它们是永远可以使用纯函数(pure function)从当前可观察状态中衍生出的值。
- **Reactions(反应)** - Reactions 是当状态改变时需要自动发生的副作用。需要有一个桥梁来连接命令式编程(imperative programming)和响应式编程(reactive programming)。或者说得更明确一些，它们最终都需要实现I / O 操作。

刚开始使用 MobX 时，人们倾向于频繁的使用 reactions。 黄金法则: 如果你想创建一个基于当前状态的值时，请使用 `computed`。

回到excel表格这个比喻中来，公式是**计算**值的衍生。但对于用户来说，能看到屏幕给出的**反应**则需要部分重绘GUI。

### 3. Actions(动作)

**动作** 是任一一段可以改变**状态**的代码。用户事件、后端数据推送、预定事件、等等。 动作类似于用户在excel单元格中输入一个新的值。

在 MobX 中可以显式地定义动作，它可以帮你把代码组织的更清晰。 如果是在[**严格模式**](https://cn.mobx.js.org/refguide/api#-enforceactions)下使用 MobX的话，MobX 会强制只有在动作之中才可以修改状态。

## 原则

MobX 支持单向数据流，也就是**动作**改变**状态**，而状态的改变会更新所有受影响的**视图**。

![[action-state-view.png]]

当**状态**改变时，所有**衍生**都会进行**原子级的自动**更新。因此永远不可能观察到中间值。

所有**衍生**默认都是**同步**更新。这意味着例如**动作**可以在改变**状态**之后直接可以安全地检查计算值。

**计算值** 是**延迟**更新的。任何不在使用状态的计算值将不会更新，直到需要它进行副作用（I / O）操作时。 如果视图不再使用，那么它会自动被垃圾回收。

所有的**计算值**都应该是**纯净**的。它们不应该用来改变**状态**。

## 如何安装 MobX？

你可以通过 npm 或者 yarn 来安装 MobX。在你的项目目录下运行以下命令：

```shell
# 使用 npm
npm install mobx --save

# 使用 yarn
yarn add mobx

# 使用 pnpm
pnpm add mobx
```

在你的项目中，你可能还需要安装 `mobx-react-lite`，它提供了在 React 项目中使用 MobX 的 hooks。

```shell
# 使用 npm
npm install mobx-react-lite --save

# 使用 yarn
yarn add mobx-react-lite

# 使用 pnpm
pnpm add mobx-react-lite
```


