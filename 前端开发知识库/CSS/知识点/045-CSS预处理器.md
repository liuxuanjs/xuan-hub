## 概述

CSS预处理器和后处理器是现代前端开发中不可或缺的工具，它们扩展了CSS的能力，提高了开发效率和代码的可维护性。

## CSS预处理器

### 基本概念

**定义：** 使用专门的编程语言书写样式，然后编译成普通CSS的工具

**核心优势：**
- 变量和常量支持
- 嵌套规则和层级结构
- Mixin和函数复用
- 运算和逻辑操作
- 模块化和引入系统

### 主流预处理器

#### Sass/SCSS

```scss
// 变量定义
$primary-color: #3498db;
$font-size-base: 16px;
$border-radius: 4px;

// Mixin定义
@mixin button-style($bg-color, $text-color: white) {
    background-color: $bg-color;
    color: $text-color;
    border: none;
    border-radius: $border-radius;
    padding: 10px 20px;
    cursor: pointer;
    
    &:hover {
        background-color: darken($bg-color, 10%);
    }
}

// 嵌套规则
.navbar {
    background: $primary-color;
    padding: 1rem;
    
    .nav-item {
        display: inline-block;
        margin-right: 1rem;
        
        a {
            color: white;
            text-decoration: none;
            
            &:hover {
                text-decoration: underline;
            }
        }
    }
}

// 使用Mixin
.btn-primary {
    @include button-style($primary-color);
}

.btn-secondary {
    @include button-style(#95a5a6);
}
```

#### Less

```less
// 变量定义
@primary-color: #3498db;
@font-size-base: 16px;
@border-radius: 4px;

// Mixin定义
.button-style(@bg-color, @text-color: white) {
    background-color: @bg-color;
    color: @text-color;
    border: none;
    border-radius: @border-radius;
    padding: 10px 20px;
    cursor: pointer;
    
    &:hover {
        background-color: darken(@bg-color, 10%);
    }
}

// 嵌套和使用
.card {
    border: 1px solid #ddd;
    border-radius: @border-radius;
    
    .header {
        background: @primary-color;
        color: white;
        padding: 1rem;
    }
    
    .body {
        padding: 1rem;
    }
}

// 使用Mixin
.btn {
    .button-style(@primary-color);
}
```

#### Stylus

```stylus
// 变量定义
primary-color = #3498db
font-size-base = 16px
border-radius = 4px

// Mixin定义
button-style(bg-color, text-color = white)
    background-color bg-color
    color text-color
    border none
    border-radius border-radius
    padding 10px 20px
    cursor pointer
    
    &:hover
        background-color darken(bg-color, 10%)

// 使用
.form-control
    border 1px solid #ddd
    border-radius border-radius
    padding 8px 12px
    
    &:focus
        border-color primary-color
        outline none

.btn-primary
    button-style(primary-color)
```

## CSS后处理器

### PostCSS介绍

**定义：** 对已经存在的CSS进行处理和转换的工具

**特点：**
- 基于插件系统
- 可以与预处理器组合使用
- 专注于优化和兼容性处理

### 常用PostCSS插件

#### Autoprefixer

```css
/* 输入 */
.example {
    display: flex;
    transition: transform 0.3s ease;
    user-select: none;
}

/* 经过Autoprefixer处理后 */
.example {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-transition: -webkit-transform 0.3s ease;
    transition: -webkit-transform 0.3s ease;
    transition: transform 0.3s ease;
    transition: transform 0.3s ease, -webkit-transform 0.3s ease;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
```

#### PostCSS Preset Env

```css
/* 输入：使用现代CSS特性 */
:root {
    --main-color: #3498db;
}

.button {
    background: var(--main-color);
    color: white;
}

@media (width >= 768px) {
    .container {
        max-width: 1200px;
    }
}

/* 输出：兼容老版浏览器 */
.button {
    background: #3498db;
    background: var(--main-color);
    color: white;
}

@media (min-width: 768px) {
    .container {
        max-width: 1200px;
    }
}
```

#### CSSnano

```css
/* 输入 */
.header {
    background-color: #ffffff;
    margin: 10px 10px 10px 10px;
    padding: 0px;
}

/* 压缩后 */
.header{background-color:#fff;margin:10px;padding:0}
```

## 实际工作流

### 项目配置示例

#### Webpack集成

```javascript
// webpack.config.js
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

module.exports = {
    module: {
        rules: [
            {
                test: /\.(sa|sc|c)ss$/,
                use: [
                    MiniCssExtractPlugin.loader,
                    'css-loader',
                    {
                        loader: 'postcss-loader',
                        options: {
                            postcssOptions: {
                                plugins: [
                                    ['autoprefixer'],
                                    ['postcss-preset-env'],
                                    ['cssnano', { preset: 'default' }]
                                ]
                            }
                        }
                    },
                    'sass-loader'
                ]
            }
        ]
    },
    plugins: [
        new MiniCssExtractPlugin({
            filename: '[name].[contenthash].css'
        })
    ]
};
```

#### Vite配置

```javascript
// vite.config.js
import { defineConfig } from 'vite';

export default defineConfig({
    css: {
        preprocessorOptions: {
            scss: {
                additionalData: `@import "@/styles/variables.scss";`
            }
        },
        postcss: {
            plugins: [
                require('autoprefixer'),
                require('postcss-preset-env')({
                    stage: 1,
                    features: {
                        'custom-properties': false
                    }
                })
            ]
        }
    }
});
```

## 高级特性与技巧

### Sass高级用法

```scss
// 条件语句
@mixin responsive($breakpoint) {
    @if $breakpoint == mobile {
        @media (max-width: 767px) { @content; }
    }
    @else if $breakpoint == tablet {
        @media (min-width: 768px) and (max-width: 1023px) { @content; }
    }
    @else if $breakpoint == desktop {
        @media (min-width: 1024px) { @content; }
    }
}

// 循环生成样式
@for $i from 1 through 12 {
    .col-#{$i} {
        width: percentage($i / 12);
    }
}

// 函数定义
@function px-to-rem($px, $base: 16px) {
    @return $px / $base * 1rem;
}

// 使用示例
.container {
    @include responsive(mobile) {
        padding: px-to-rem(16px);
    }
    
    @include responsive(desktop) {
        padding: px-to-rem(32px);
    }
}
```

### PostCSS自定义插件

```javascript
// postcss-custom-plugin.js
module.exports = () => {
    return {
        postcssPlugin: 'custom-plugin',
        Rule(rule) {
            // 处理规则
            if (rule.selector.includes('.old-class')) {
                rule.selector = rule.selector.replace('.old-class', '.new-class');
            }
        },
        Declaration(decl) {
            // 处理属性
            if (decl.prop === 'margin-x') {
                decl.cloneBefore({ prop: 'margin-left', value: decl.value });
                decl.cloneBefore({ prop: 'margin-right', value: decl.value });
                decl.remove();
            }
        }
    };
};
```

## 性能优化

### 编译缓存

```javascript
// 使用缓存加速编译
const path = require('path');

module.exports = {
    module: {
        rules: [
            {
                test: /\.(sa|sc)ss$/,
                use: [
                    'css-loader',
                    {
                        loader: 'sass-loader',
                        options: {
                            // 启用缓存
                            sassOptions: {
                                includePaths: [path.resolve(__dirname, 'src/styles')]
                            }
                        }
                    }
                ]
            }
        ]
    },
    // 使用cache-loader加速编译
    cache: {
        type: 'filesystem',
        cacheDirectory: path.resolve(__dirname, '.cache')
    }
};
```

### 按需加载

```scss
// 模块化的样式组织
// styles/base/_variables.scss
$primary-color: #3498db;

// styles/components/_button.scss
@import '../base/variables';

.btn {
    background: $primary-color;
}

// styles/pages/_home.scss
@import '../components/button';

.home-page {
    .hero-section {
        .cta-button {
            @extend .btn;
        }
    }
}
```

## 最佳实践

### 项目结构

```
src/
  styles/
    base/
      _reset.scss
      _variables.scss
      _mixins.scss
    components/
      _button.scss
      _card.scss
      _modal.scss
    layouts/
      _header.scss
      _footer.scss
      _grid.scss
    pages/
      _home.scss
      _about.scss
    vendors/
      _normalize.scss
    main.scss
```

### 主入口文件

```scss
// main.scss
// 1. 基础样式
@import 'vendors/normalize';
@import 'base/variables';
@import 'base/mixins';
@import 'base/reset';

// 2. 布局样式
@import 'layouts/grid';
@import 'layouts/header';
@import 'layouts/footer';

// 3. 组件样式
@import 'components/button';
@import 'components/card';
@import 'components/modal';

// 4. 页面样式
@import 'pages/home';
@import 'pages/about';
```

### 开发流程建议

1. **选择合适的预处理器：** 根据团队技能和项目需求
2. **统一代码风格：** 制定和遵守编码规范
3. **模块化组织：** 合理分割和组织样式文件
4. **性能监控：** 关注编译速度和输出CSS大小
5. **持续优化：** 定期审查和优化样式代码

预处理器和后处理器极大地提升了CSS开发的效率和质量，是现代前端工程化的重要组成部分。

## 标签
#CSS #前端面试