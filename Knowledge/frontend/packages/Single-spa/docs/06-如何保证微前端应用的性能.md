
### 1. 代码分割和懒加载

```typescript
// 应用级别的懒加载
const loadingFnc = () => SystemJS.import(entrance);

// 路由级别的懒加载
const LazyComponent = React.lazy(() => import('./Component'));
```

**优化策略：**

- 按应用维度进行代码分割
- 路由级别的组件懒加载
- 第三方库按需引入

### 2. 资源预加载策略

```typescript
// 关键资源预加载
SystemStore.fetchSystemConfig(); // 预加载系统配置
ThemeStore.fetch(); // 预加载主题配置

// 智能预加载
const preloadApp = (appName: string) => {
  SystemJS.import(getAppEntrance(appName));
};
```

**预加载时机：**

- 用户空闲时预加载可能访问的应用
- 根据用户行为预测预加载优先级
- 关键路径资源优先预加载

### 3. 缓存策略优化

```javascript
// Webpack 配置长期缓存
output: {
  filename: '[name].[contenthash:8].js',
  chunkFilename: '[name].[contenthash:8].chunk.js'
}

// HTTP 缓存策略
Cache-Control: public, max-age=31536000  // 静态资源
Cache-Control: no-cache                  // HTML文件
```

**缓存层次：**

- 浏览器缓存：长期缓存静态资源
- CDN 缓存：全球分发加速
- 应用缓存：运行时数据缓存

### 4. Bundle 分析和优化

**分析工具：**

```bash
# 使用 webpack-bundle-analyzer 分析包大小
npm run build -- --analyze
```

**优化措施：**

- 按需引入第三方库，避免全量引入
- 提取公共依赖到 Common Package
- 移除未使用的代码（Tree Shaking）

### 5. 运行时性能优化

```typescript
// 应用状态监控
const performanceObserver = new PerformanceObserver((list) => {
  list.getEntries().forEach((entry) => {
    if (entry.entryType === 'navigation') {
      console.log('页面加载时间:', entry.loadEventEnd - entry.fetchStart);
    }
  });
});

// 内存使用监控
const checkMemoryUsage = () => {
  if (performance.memory) {
    console.log('内存使用:', {
      used: performance.memory.usedJSHeapSize,
      total: performance.memory.totalJSHeapSize,
      limit: performance.memory.jsHeapSizeLimit,
    });
  }
};
```

### 6. 网络请求优化

```typescript
// 请求合并和缓存
class APIService {
  private cache = new Map();

  async fetchWithCache(url: string) {
    if (this.cache.has(url)) {
      return this.cache.get(url);
    }

    const response = await fetch(url);
    const data = await response.json();
    this.cache.set(url, data);
    return data;
  }
}
```

**优化策略：**

- API 请求合并减少网络开销
- 实现请求缓存机制
- 使用 HTTP/2 多路复用

### 7. 渲染性能优化

```typescript
// React 性能优化
const MemoizedComponent = React.memo(Component);

// 虚拟滚动处理大列表
import { FixedSizeList as List } from 'react-window';

const VirtualizedList = ({ items }) => (
  <List height={600} itemCount={items.length} itemSize={50}>
    {({ index, style }) => <div style={style}>{items[index]}</div>}
  </List>
);
```

### 8. 性能监控和告警

```typescript
// 性能指标收集
const collectMetrics = () => {
  return {
    FCP: performance.getEntriesByName('first-contentful-paint')[0]?.startTime,
    LCP: performance.getEntriesByType('largest-contentful-paint')[0]?.startTime,
    FID: performance.getEntriesByType('first-input')[0]?.processingStart,
    CLS: getCLS(), // 累积布局偏移
  };
};

// 性能告警
if (metrics.LCP > 2500) {
  console.warn('LCP 指标超过阈值');
  // 发送告警
}
```

### 性能优化效果

| 优化项目     | 优化前 | 优化后 | 提升幅度 |
| ------------ | ------ | ------ | -------- |
| 首屏加载时间 | 3.2s   | 1.8s   | 44% ↓    |
| 应用切换时间 | 1.5s   | 0.6s   | 60% ↓    |
| Bundle 大小  | 2.1MB  | 1.3MB  | 38% ↓    |
| 内存占用     | 85MB   | 62MB   | 27% ↓    |

[← 上一个问题：技术挑战和解决方案](05-项目中遇到了哪些技术挑战和坑点.md) | [下一个问题：团队协作机制 →](07-团队协作和开发效率如何提升.md)
