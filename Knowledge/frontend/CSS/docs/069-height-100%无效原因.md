## 概述
在CSS中，设置`height: 100%`有时候不会生效，这是一个常见的布局问题。理解其原因对于正确使用高度属性至关重要。

## 问题现象

### 常见的无效情况
```css
.container {
    height: 100%; /* 不生效 */
    background: red;
}
```

```html
<div class="container">
    <p>这个容器的高度可能不是100%</p>
</div>
```

## 原因分析

### 1. 百分比高度的计算规则
- **百分比高度**是相对于**父元素的高度**计算的
- 如果父元素没有明确的高度，子元素的百分比高度就无法计算
- 浏览器会将其视为`height: auto`

### 2. 默认情况下的文档结构
```html
<!DOCTYPE html>
<html>     <!-- 默认高度：auto -->
<body>     <!-- 默认高度：auto -->
    <div class="container"> <!-- height: 100% 无效 -->
        内容
    </div>
</body>
</html>
```

### 3. 高度继承链断裂
- `html`元素默认高度为`auto`
- `body`元素默认高度为`auto`  
- 子元素无法从`auto`高度计算出100%

## 解决方案

### 1. 设置完整的高度链
```css
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
}

.container {
    height: 100%; /* 现在有效了 */
    background: red;
}
```

### 2. 使用视口单位
```css
.container {
    height: 100vh; /* 视口高度的100% */
    background: red;
}
```

### 3. 使用绝对定位
```css
.container {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background: red;
}
```

### 4. 使用Flexbox
```css
body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.container {
    flex: 1; /* 占据剩余空间 */
    background: red;
}
```

### 5. 使用Grid布局
```css
body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: grid;
    grid-template-rows: 1fr;
}

.container {
    background: red;
}
```

## 具体案例分析

### 案例1：模态框全屏背景
```css
/* 问题代码 */
.modal-backdrop {
    height: 100%; /* 可能无效 */
    background: rgba(0, 0, 0, 0.5);
}

/* 解决方案 */
.modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
}

/* 或者使用视口单位 */
.modal-backdrop {
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.5);
}
```

### 案例2：侧边栏全高
```css
/* 问题代码 */
.sidebar {
    height: 100%; /* 可能无效 */
    background: #f5f5f5;
}

/* 解决方案1：设置高度链 */
html, body {
    height: 100%;
    margin: 0;
}

.main-container {
    height: 100%;
    display: flex;
}

.sidebar {
    height: 100%; /* 现在有效 */
    width: 250px;
    background: #f5f5f5;
}

/* 解决方案2：使用vh */
.sidebar {
    height: 100vh;
    width: 250px;
    background: #f5f5f5;
}
```

### 案例3：内容区域全高
```css
/* 问题代码 */
.content-area {
    height: 100%; /* 无效 */
    overflow-y: auto;
}

/* 解决方案：使用calc和vh */
.content-area {
    height: calc(100vh - 60px); /* 减去头部高度 */
    overflow-y: auto;
}

/* 或者使用Flexbox */
.app-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
}

.header {
    flex: 0 0 60px;
}

.content-area {
    flex: 1;
    overflow-y: auto;
}
```

## 特殊情况处理

### 1. 表格中的百分比高度
```css
.table-container {
    height: 400px; /* 给定明确高度 */
}

.table-cell {
    height: 100%; /* 相对于400px计算 */
    vertical-align: top;
}
```

### 2. 绝对定位元素的百分比高度
```css
.relative-parent {
    position: relative;
    height: 500px; /* 明确高度 */
}

.absolute-child {
    position: absolute;
    height: 100%; /* 相对于500px计算 */
    width: 100%;
}
```

### 3. 响应式设计中的高度
```css
.responsive-container {
    min-height: 100vh; /* 最小高度为视口高度 */
    height: auto; /* 内容撑开 */
}

@media (max-width: 768px) {
    .responsive-container {
        min-height: calc(100vh - 50px); /* 移动端减去地址栏 */
    }
}
```

## 调试技巧

### 1. 使用开发者工具检查
```css
/* 临时添加边框查看实际高度 */
.debug {
    border: 2px solid red !important;
    box-sizing: border-box;
}
```

### 2. 检查父元素高度
```javascript
// 控制台中检查父元素高度
const element = document.querySelector('.container');
const parent = element.parentElement;
console.log('父元素高度:', window.getComputedStyle(parent).height);
```

### 3. 逐级设置高度测试
```css
/* 逐级测试每个父元素 */
html { height: 100%; background: red; }
body { height: 100%; background: green; }
.wrapper { height: 100%; background: blue; }
.container { height: 100%; background: yellow; }
```

## 最佳实践

### 1. 现代布局优先
```css
/* 推荐：使用现代布局方案 */
.app {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

/* 避免：复杂的百分比高度 */
.app {
    height: 100%;
}
```

### 2. 明确的高度设置
```css
/* 推荐：明确指定高度 */
.container {
    height: 400px;
    min-height: 300px;
    max-height: 600px;
}

/* 避免：模糊的百分比依赖 */
.container {
    height: 100%;
}
```

### 3. 使用CSS Grid和Flexbox
```css
/* 推荐：现代布局解决方案 */
.layout {
    display: grid;
    grid-template-rows: auto 1fr auto;
    min-height: 100vh;
}

.header { /* 自动高度 */ }
.main { /* 占据剩余空间 */ }
.footer { /* 自动高度 */ }
```

## 浏览器兼容性

- `height: 100%`: 所有浏览器
- `100vh`: IE9+
- `calc()`: IE9+
- Flexbox: IE11+
- Grid: IE10+

## 总结

`height: 100%`无效的根本原因是缺少明确的父元素高度。解决方案包括：

1. **设置完整的高度链**（html, body都设置100%）
2. **使用视口单位**（vh, vmin, vmax）
3. **使用现代布局**（Flexbox, Grid）
4. **使用绝对定位**
5. **明确指定父元素高度**

现代开发中，推荐使用Flexbox、Grid或视口单位来解决高度问题，避免复杂的百分比高度依赖。