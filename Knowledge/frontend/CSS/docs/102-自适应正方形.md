## 概述
自适应正方形是指创建一个宽高比始终为1:1的元素，无论容器宽度如何变化，该元素都保持正方形的形状。

## 实现方案

### 1. 基于百分比padding的方案

#### 原理
- padding的百分比值是基于父元素的宽度计算的
- 利用这个特性可以创建高度与宽度成比例的元素

#### 实现
```css
.square {
    width: 100%;
    height: 0;
    padding-bottom: 100%; /* 高度等于宽度 */
    background: #3498db;
    position: relative;
}

.square-content {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}
```

```html
<div class="square">
    <div class="square-content">
        正方形内容
    </div>
</div>
```

### 2. 使用vw单位

#### 实现
```css
.square {
    width: 50vw;
    height: 50vw;
    background: #e74c3c;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}
```

#### 响应式vw方案
```css
.square {
    width: 20vw;
    height: 20vw;
    background: #2ecc71;
    margin: 10px;
    display: inline-block;
}

@media (max-width: 768px) {
    .square {
        width: 40vw;
        height: 40vw;
    }
}
```

### 3. 使用aspect-ratio（现代方案）

#### CSS实现
```css
.square {
    width: 100%;
    aspect-ratio: 1 / 1;
    background: #9b59b6;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}
```

#### 兼容性处理
```css
.square {
    width: 100%;
    background: #f39c12;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    
    /* 现代浏览器 */
    aspect-ratio: 1 / 1;
}

/* 兼容旧浏览器 */
@supports not (aspect-ratio: 1 / 1) {
    .square {
        height: 0;
        padding-bottom: 100%;
        position: relative;
    }
    
    .square::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
}
```

### 4. JavaScript动态设置

#### 实现
```javascript
function makeSquare() {
    const squares = document.querySelectorAll('.js-square');
    squares.forEach(square => {
        const width = square.offsetWidth;
        square.style.height = width + 'px';
    });
}

// 页面加载时执行
window.addEventListener('load', makeSquare);
// 窗口大小改变时执行
window.addEventListener('resize', makeSquare);
```

```css
.js-square {
    width: 100%;
    background: #34495e;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    transition: height 0.3s ease;
}
```

### 5. 使用伪元素撑开高度

#### 实现
```css
.square {
    width: 100%;
    background: #1abc9c;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.square::before {
    content: '';
    display: block;
    width: 100%;
    padding-top: 100%;
}

.square-content {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}
```

## 实际应用场景

### 1. 图片正方形展示
```css
.image-square {
    width: 100%;
    aspect-ratio: 1 / 1;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: 8px;
    overflow: hidden;
}

.image-square img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
```

### 2. 正方形网格布局
```css
.grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    padding: 20px;
}

.grid-item {
    aspect-ratio: 1 / 1;
    background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 18px;
    font-weight: bold;
    transition: transform 0.3s ease;
}

.grid-item:hover {
    transform: scale(1.05);
}
```

### 3. 头像正方形容器
```css
.avatar-square {
    width: 80px;
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    background: #95a5a6;
    overflow: hidden;
    position: relative;
}

.avatar-square img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-square::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 2px solid white;
    border-radius: 50%;
    box-sizing: border-box;
}
```

### 4. 响应式正方形卡片
```css
.card-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    padding: 20px;
}

.card {
    flex: 0 0 calc(33.333% - 14px);
    aspect-ratio: 1 / 1;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 20px;
    box-sizing: border-box;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

@media (max-width: 768px) {
    .card {
        flex: 0 0 calc(50% - 10px);
    }
}

@media (max-width: 480px) {
    .card {
        flex: 0 0 100%;
    }
}
```

### 5. 正方形加载动画
```css
.loading-square {
    width: 50px;
    aspect-ratio: 1 / 1;
    background: #3498db;
    border-radius: 4px;
    animation: square-pulse 1.5s ease-in-out infinite;
}

@keyframes square-pulse {
    0%, 100% {
        transform: scale(1);
        opacity: 1;
    }
    50% {
        transform: scale(0.8);
        opacity: 0.7;
    }
}
```

## 各方案对比

| 方案 | 优点 | 缺点 | 兼容性 |
|------|------|------|--------|
| padding百分比 | 兼容性好，稳定可靠 | 需要额外标签，实现复杂 | IE6+ |
| vw单位 | 实现简单，真正响应式 | 基于视口宽度，不够灵活 | IE9+ |
| aspect-ratio | 最简洁的实现 | 兼容性差 | Chrome 88+ |
| JavaScript | 灵活可控 | 依赖JS，性能影响 | 所有浏览器 |
| 伪元素 | 不需要额外标签 | 实现稍复杂 | IE8+ |

## 兼容性处理

### 渐进增强方案
```css
.square {
    width: 100%;
    height: 200px; /* 降级方案 */
    background: #e67e22;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

/* 支持vw的浏览器 */
@supports (width: 1vw) {
    .square {
        height: 100vw;
        max-height: 400px;
    }
}

/* 支持aspect-ratio的浏览器 */
@supports (aspect-ratio: 1 / 1) {
    .square {
        height: auto;
        max-height: none;
        aspect-ratio: 1 / 1;
    }
}
```

## 注意事项

### 1. 内容溢出处理
```css
.square {
    aspect-ratio: 1 / 1;
    overflow: hidden; /* 防止内容溢出 */
}

.square-content {
    width: 100%;
    height: 100%;
    overflow-y: auto; /* 内容过多时滚动 */
}
```

### 2. 最小/最大尺寸限制
```css
.square {
    aspect-ratio: 1 / 1;
    min-width: 100px;
    max-width: 500px;
    width: 30vw;
}
```

### 3. 性能优化
```css
.square {
    aspect-ratio: 1 / 1;
    contain: layout style; /* CSS Containment */
    will-change: transform; /* 预期变化 */
}
```

## 浏览器兼容性

- padding百分比: IE6+
- vw单位: IE9+
- aspect-ratio: Chrome 88+, Firefox 89+, Safari 15+
- 伪元素方案: IE8+

## 总结

- aspect-ratio是最现代的解决方案，代码最简洁
- padding百分比方案兼容性最好，适合生产环境
- vw方案适合基于视口的响应式设计
- 选择方案时要考虑兼容性要求和具体使用场景
- 可以使用@supports实现渐进增强