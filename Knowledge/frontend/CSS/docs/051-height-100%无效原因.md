## 概述

在CSS布局中，设置`height: 100%`经常不生效，这是因为百分比高度的计算依赖于父元素的明确高度值。理解这个原理对于实现自适应高度布局至关重要。

## 问题原因

### 百分比计算规则

**基本规则：**
- 百分比高度需要基于父元素的高度进行计算
- 如果父元素高度为`auto`（由内容决定），则无法计算百分比
- 结果是百分比高度被忽略，元素高度变为内容高度

```html
<div class="parent">
    <div class="child">内容</div>
</div>
```

```css
.parent {
    /* 没有显式设置高度，由内容决定 */
}

.child {
    height: 100%; /* 无效！父元素高度为auto */
    background: red;
}
```

### 包含块概念

**包含块规则：**
- 普通流元素的包含块是其最近的块级祖先元素的内容区域
- 绝对定位元素的包含块是最近的positioned祖先元素的padding区域
- 百分比高度相对于包含块的高度计算

## 解决方案

### 1. 显式设置父元素高度

```css
.parent {
    height: 400px; /* 明确指定高度 */
}

.child {
    height: 100%; /* 现在有效：400px */
    background: red;
}
```

### 2. 使用视口单位

```css
.child {
    height: 100vh; /* 相对于视口高度 */
    background: red;
}
```

### 3. 传递高度链

```css
html, body {
    height: 100%; /* 从根开始设置高度 */
    margin: 0;
    padding: 0;
}

.parent {
    height: 100%; /* 继承body的高度 */
}

.child {
    height: 100%; /* 现在可以正常工作 */
    background: red;
}
```

### 4. 绝对定位方案

```css
.parent {
    position: relative;
    /* 高度可以为auto */
}

.child {
    position: absolute;
    top: 0;
    bottom: 0; /* 拉伸到父元素高度 */
    left: 0;
    right: 0;
    background: red;
}
```

### 5. Flexbox方案

```css
.parent {
    display: flex;
    flex-direction: column;
    height: 100vh; /* 给容器一个明确高度 */
}

.child {
    flex: 1; /* 自动填充剩余空间 */
    background: red;
}
```

### 6. Grid方案

```css
.parent {
    display: grid;
    grid-template-rows: 1fr;
    height: 100vh;
}

.child {
    background: red;
    /* 自动占满网格区域 */
}
```

## 实际应用场景

### 全屏布局

```css
/* 方法1：传统方法 */
html, body {
    height: 100%;
    margin: 0;
}

.app {
    height: 100%;
}

/* 方法2：现代方法 */
.app {
    height: 100vh;
    min-height: 100vh;
}
```

### 侧边栏布局

```css
.layout {
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 250px;
    /* height: 100%; 不需要，flex子项自动拉伸 */
    background: #f0f0f0;
}

.main {
    flex: 1;
    /* height: 100%; 不需要 */
    background: white;
}
```

### 卡片内容区域

```css
.card {
    height: 300px; /* 给卡片明确高度 */
    display: flex;
    flex-direction: column;
}

.card-header {
    padding: 15px;
    background: #f8f9fa;
}

.card-body {
    flex: 1; /* 占据剩余空间 */
    padding: 15px;
    overflow-y: auto;
}
```

## 特殊情况

### 表格中的百分比高度

```css
.table {
    height: 400px; /* 表格需要明确高度 */
    table-layout: fixed;
}

.table td {
    height: 100%; /* 相对于表格行高度 */
    vertical-align: top;
}
```

### 绝对定位的特殊性

```css
.parent {
    position: relative;
    /* 高度可以是auto */
}

.absolute-child {
    position: absolute;
    height: 100%; /* 有效！相对于positioned父元素 */
    top: 0;
    left: 0;
    background: red;
}
```

## 调试技巧

### 检查父元素高度

```javascript
// 检查元素及其父元素的高度
function debugHeight(element) {
    let current = element;
    const heights = [];
    
    while (current && current !== document.body) {
        const computed = getComputedStyle(current);
        heights.push({
            element: current.tagName,
            className: current.className,
            height: computed.height,
            computedHeight: current.offsetHeight + 'px'
        });
        current = current.parentElement;
    }
    
    console.table(heights);
}

// 使用示例
const problematicElement = document.querySelector('.child');
debugHeight(problematicElement);
```

### CSS调试样式

```css
/* 调试：显示所有元素的边框 */
* {
    outline: 1px solid rgba(255, 0, 0, 0.5);
}

/* 显示高度信息 */
[style*="height"]::before {
    content: "Height set";
    position: absolute;
    background: yellow;
    font-size: 12px;
    z-index: 9999;
}
```

## 最佳实践

1. **明确容器高度：** 确保父容器有明确的高度值
2. **使用现代布局：** 优先考虑Flexbox或Grid
3. **视口单位：** 对于全屏布局使用vh/vw单位
4. **避免深层嵌套：** 减少高度传递链的复杂性
5. **测试验证：** 在不同内容长度下测试布局表现

## 兼容性考虑

- `vh/vw`单位：IE9+支持，移动端注意地址栏影响
- `flexbox`：IE10+支持，注意flex属性的兼容性写法
- `grid`：IE10+部分支持，现代浏览器完全支持

理解百分比高度的计算规则，可以帮助我们避免布局问题，选择最合适的解决方案。

## 标签
#CSS #前端面试