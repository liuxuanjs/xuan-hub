## 概述

视差滚动是一种现代网页设计技术，通过让不同图层以不同的速度移动，创造出具有深度感和立体感的视觉效果，提升用户的浏览体验。

## 基本原理

### 视差效果原理

**多层移动：**
- 前景元素移动速度快
- 背景元素移动速度慢
- 形成景深错觉和立体感

```css
/* 基础视差效果 */
.parallax-container {
    height: 100vh;
    overflow-x: hidden;
    overflow-y: auto;
    perspective: 1px;
}

.parallax-element {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

.parallax-back {
    transform: translateZ(-1px) scale(2);
}

.parallax-base {
    transform: translateZ(0);
}
```

## 实现方式

### CSS Transform方法

```css
.parallax-wrapper {
    height: 100vh;
    overflow-x: hidden;
    overflow-y: auto;
    perspective: 1px;
}

.section {
    position: relative;
    transform-style: preserve-3d;
    padding: 50vh 0;
}

.parallax-layer {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

/* 不同速度的图层 */
.parallax-back {
    transform: translateZ(-1px) scale(2);
}

.parallax-mid {
    transform: translateZ(-0.5px) scale(1.5);
}

.parallax-front {
    transform: translateZ(0);
}
```

### JavaScript控制法

```javascript
window.addEventListener('scroll', () => {
    const scrolled = window.pageYOffset;
    const parallaxElements = document.querySelectorAll('.parallax');
    
    parallaxElements.forEach(element => {
        const speed = element.dataset.speed;
        const yPos = -(scrolled * speed / 100);
        element.style.transform = `translateY(${yPos}px)`;
    });
});
```

```html
<div class="parallax" data-speed="20">背景层</div>
<div class="parallax" data-speed="50">中景层</div>
<div class="parallax" data-speed="80">前景层</div>
```

## 动画控制

### 出现一次的动画

```javascript
const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -100px 0px'
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('animate');
            // 移除观察，确保只执行一次
            observer.unobserve(entry.target);
        }
    });
}, observerOptions);

document.querySelectorAll('.animate-once').forEach(el => {
    observer.observe(el);
});
```

### 重复出现的动画

```javascript
const repeatObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('animate');
        } else {
            entry.target.classList.remove('animate');
        }
    });
}, observerOptions);

document.querySelectorAll('.animate-repeat').forEach(el => {
    repeatObserver.observe(el);
});
```

### CSS动画定义

```css
.animate-once {
    opacity: 0;
    transform: translateY(50px);
    transition: all 0.6s ease;
}

.animate-once.animate {
    opacity: 1;
    transform: translateY(0);
}

.animate-repeat {
    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.animate-repeat:not(.animate) {
    opacity: 0.3;
    transform: scale(0.8);
}

.animate-repeat.animate {
    opacity: 1;
    transform: scale(1);
}
```

## 性能优化

### 节流处理

```javascript
function throttle(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

const handleScroll = throttle(() => {
    // 视差滚动逻辑
}, 16); // 约60fps

window.addEventListener('scroll', handleScroll);
```

### GPU加速

```css
.parallax-element {
    will-change: transform;
    backface-visibility: hidden;
    transform: translateZ(0); /* 开启GPU加速 */
}
```

## 实际应用示例

### 基础视差页面

```html
<div class="parallax-container">
    <section class="hero">
        <div class="parallax-layer parallax-back">
            <img src="bg.jpg" alt="背景">
        </div>
        <div class="parallax-layer parallax-base">
            <h1>标题内容</h1>
        </div>
    </section>
</div>
```

### 多层视差效果

```css
.hero {
    position: relative;
    height: 100vh;
    overflow: hidden;
}

.cloud-1 { transform: translateZ(-3px) scale(4); }
.cloud-2 { transform: translateZ(-2px) scale(3); }
.mountain { transform: translateZ(-1px) scale(2); }
.foreground { transform: translateZ(0); }
```

## 注意事项

### 性能考虑

- **移动端优化：** 在移动设备上谨慎使用
- **滚动性能：** 避免在滚动事件中进行复杂计算
- **内存管理：** 及时清理不需要的监听器

### 用户体验

- **减弱效果：** 为有前庭疾病的用户提供选项
- **加载提示：** 大图片加载时显示占位符
- **回退方案：** 在不支持的浏览器中提供静态体验

## 标签
#CSS #前端面试