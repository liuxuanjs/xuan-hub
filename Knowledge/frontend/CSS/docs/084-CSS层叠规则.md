# CSS层叠规则

## 概述
CSS层叠规则决定了当多个样式规则作用于同一个元素时，哪个样式会最终生效。理解层叠规则对于解决样式冲突很重要。

## 层叠顺序（从低到高）

### 1. 浏览器默认样式
```css
/* 浏览器内置样式，优先级最低 */
h1 { font-size: 2em; font-weight: bold; }
p { margin: 1em 0; }
```

### 2. 用户样式表
```css
/* 用户自定义的样式，如浏览器设置 */
* { font-family: "Custom Font" !important; }
```

### 3. 作者样式表（网站CSS）
```css
/* 开发者编写的样式 */
.header { background: blue; }
```

### 4. 作者!important声明
```css
.header { background: red !important; }
```

### 5. 用户!important声明
```css
/* 用户的!important声明，优先级最高 */
* { font-size: 16px !important; }
```

## 选择器优先级计算

### 优先级权重
- 内联样式：1000
- ID选择器：100  
- 类选择器、属性选择器、伪类：10
- 元素选择器、伪元素：1

### 计算示例
```css
/* 优先级：1 */
p { color: black; }

/* 优先级：10 */
.text { color: blue; }

/* 优先级：100 */
#title { color: red; }

/* 优先级：111 (100+10+1) */
#title.text p { color: green; }

/* 优先级：1000 */
<p style="color: yellow;">内联样式</p>
```

## 相同优先级的层叠

### 后来者居上
```css
.text { color: red; }    /* 先定义 */
.text { color: blue; }   /* 后定义，会覆盖前面的 */
```

### 来源顺序
```html
<link rel="stylesheet" href="first.css">  <!-- 先加载 -->
<link rel="stylesheet" href="second.css"> <!-- 后加载，优先级更高 -->
```

## 实际应用

### 1. 重置样式冲突
```css
/* 问题：样式被覆盖 */
.button { background: blue; }

/* 解决：提高优先级 */
.container .button { background: blue; }

/* 或使用!important（不推荐） */
.button { background: blue !important; }
```

### 2. 组件样式隔离
```css
/* 组件样式 */
.card { padding: 20px; }
.card .title { font-size: 18px; }
.card .content { color: #666; }

/* 避免全局样式影响 */
.my-card.card { padding: 20px; } /* 提高优先级 */
```

### 3. 主题覆盖
```css
/* 基础主题 */
.theme-default .button { background: #007bff; }

/* 深色主题覆盖 */
.theme-dark .button { background: #343a40; }
```

## 最佳实践

### 1. 避免使用!important
```css
/* 不推荐 */
.text { color: red !important; }

/* 推荐：通过选择器优先级控制 */
.container .text { color: red; }
```

### 2. 合理的CSS架构
```css
/* 基础样式 - 低优先级 */
.btn { padding: 10px; }

/* 组件样式 - 中等优先级 */
.btn-primary { background: blue; }

/* 状态样式 - 高优先级 */
.btn-primary:hover { background: darkblue; }
```

### 3. 使用CSS方法论
```css
/* BEM命名法 */
.block { }
.block__element { }
.block--modifier { }

/* 避免嵌套过深 */
.header .nav .menu .item { } /* 不推荐 */
.nav-item { } /* 推荐 */
```

## 调试技巧

### 浏览器开发者工具
- 查看计算样式
- 观察被覆盖的样式（划掉显示）
- 检查样式优先级

### CSS注释标记
```css
.debug {
    color: red; /* 调试用，待删除 */
    background: yellow !important; /* 临时覆盖 */
}
```

## 现代解决方案

### CSS Modules
```css
/* styles.module.css */
.button {
    composes: baseButton from './base.css';
    background: blue;
}
```

### CSS-in-JS
```javascript
const StyledButton = styled.button`
    background: ${props => props.primary ? 'blue' : 'gray'};
`;
```

### CSS自定义属性
```css
:root {
    --primary-color: blue;
}

.button {
    background: var(--primary-color);
}

/* 局部覆盖 */
.dark-theme {
    --primary-color: darkblue;
}
```

## 浏览器兼容性

- CSS层叠规则：所有浏览器
- CSS自定义属性：IE不支持
- CSS Modules：需要构建工具

## 总结

CSS层叠规则的关键点：

1. **优先级顺序**：内联 > ID > 类 > 元素
2. **!important最高**：但应避免使用
3. **后来者居上**：相同优先级时
4. **就近原则**：更具体的选择器优先
5. **架构重要**：合理的CSS结构避免冲突

理解层叠规则有助于写出更可维护的CSS代码。