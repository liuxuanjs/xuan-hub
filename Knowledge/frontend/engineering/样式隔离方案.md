# å‰ç«¯æ ·å¼éš”ç¦»æ–¹æ¡ˆ

åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§å‹é¡¹ç›®å’Œå¾®å‰ç«¯æ¶æ„ä¸­ï¼Œæ ·å¼éš”ç¦»æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜ã€‚ä¸åŒç»„ä»¶ã€æ¨¡å—æˆ–åº”ç”¨ä¹‹é—´çš„æ ·å¼å†²çªä¼šå¯¼è‡´æ„æ–™ä¹‹å¤–çš„æ ·å¼è¦†ç›–ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

## ğŸ“‹ ç›®å½•

- [é—®é¢˜èƒŒæ™¯](#é—®é¢˜èƒŒæ™¯)
- [å¸¸è§æ ·å¼å†²çªåœºæ™¯](#å¸¸è§æ ·å¼å†²çªåœºæ™¯)
- [æ ·å¼éš”ç¦»æ–¹æ¡ˆ](#æ ·å¼éš”ç¦»æ–¹æ¡ˆ)
- [æ–¹æ¡ˆå¯¹æ¯”](#æ–¹æ¡ˆå¯¹æ¯”)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ€»ç»“](#æ€»ç»“)

## é—®é¢˜èƒŒæ™¯

### ä¸ºä»€ä¹ˆéœ€è¦æ ·å¼éš”ç¦»ï¼Ÿ

1. **å…¨å±€æ±¡æŸ“**ï¼šCSS çš„å…¨å±€ç‰¹æ€§å¯¼è‡´æ ·å¼å®¹æ˜“ç›¸äº’å½±å“
2. **å‘½åå†²çª**ï¼šä¸åŒå¼€å‘è€…å¯èƒ½ä½¿ç”¨ç›¸åŒçš„ç±»å
3. **ä¼˜å…ˆçº§æ··ä¹±**ï¼šCSS é€‰æ‹©å™¨ä¼˜å…ˆçº§éš¾ä»¥æ§åˆ¶
4. **ç»´æŠ¤å›°éš¾**ï¼šå¤§å‹é¡¹ç›®ä¸­æ ·å¼ä¾èµ–å…³ç³»å¤æ‚
5. **å¾®å‰ç«¯åœºæ™¯**ï¼šå¤šä¸ªåº”ç”¨å…±å­˜æ—¶æ ·å¼å†²çªé¢‘ç¹

### å¸¸è§æ ·å¼å†²çªåœºæ™¯

```css
/* åº”ç”¨ A */
.header {
  background-color: blue;
  height: 60px;
}

/* åº”ç”¨ B */
.header {
  background-color: red;
  height: 80px;
}

/* ç»“æœï¼šååŠ è½½çš„æ ·å¼ä¼šè¦†ç›–å‰é¢çš„æ ·å¼ */
```

## æ ·å¼éš”ç¦»æ–¹æ¡ˆ

### 1. CSS Modules

**åŸç†**ï¼šç¼–è¯‘æ—¶å°†ç±»åè½¬æ¢ä¸ºå”¯ä¸€æ ‡è¯†ç¬¦

```css
/* Button.module.css */
.button {
  background-color: blue;
  padding: 10px 20px;
}

.primary {
  background-color: #007bff;
}
```

```jsx
// Button.jsx
import styles from './Button.module.css';

function Button() {
  return (
    <button className={styles.button}>
      Click me
    </button>
  );
}
```

**ç¼–è¯‘åçš„ç»“æœ**ï¼š
```css
.Button_button__2x3k4 {
  background-color: blue;
  padding: 10px 20px;
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®Œå…¨éš”ç¦»ï¼Œæ— æ ·å¼å†²çª
- âœ… æ”¯æŒç»„åˆå’Œç»§æ‰¿
- âœ… æ„å»ºæ—¶ä¼˜åŒ–ï¼Œè¿è¡Œæ—¶æ€§èƒ½å¥½
- âœ… IDE æ”¯æŒè‰¯å¥½

**ç¼ºç‚¹**ï¼š
- âŒ éœ€è¦æ„å»ºå·¥å…·æ”¯æŒ
- âŒ åŠ¨æ€æ ·å¼å¤„ç†å¤æ‚
- âŒ ç¬¬ä¸‰æ–¹åº“æ ·å¼è¦†ç›–å›°éš¾

### 2. CSS-in-JS

**åŸç†**ï¼šå°†æ ·å¼å†™åœ¨ JavaScript ä¸­ï¼Œè¿è¡Œæ—¶ç”Ÿæˆå”¯ä¸€ç±»å

#### Styled-components

```jsx
import styled from 'styled-components';

const Button = styled.button`
  background-color: ${props => props.primary ? '#007bff' : '#6c757d'};
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  
  &:hover {
    opacity: 0.8;
  }
`;

function App() {
  return (
    <div>
      <Button>æ™®é€šæŒ‰é’®</Button>
      <Button primary>ä¸»è¦æŒ‰é’®</Button>
    </div>
  );
}
```

#### Emotion

```jsx
/** @jsxImportSource @emotion/react */
import { css } from '@emotion/react';

const buttonStyle = css`
  background-color: #007bff;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  
  &:hover {
    opacity: 0.8;
  }
`;

function Button() {
  return <button css={buttonStyle}>Click me</button>;
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®Œå…¨éš”ç¦»
- âœ… æ”¯æŒåŠ¨æ€æ ·å¼
- âœ… JavaScript ç”Ÿæ€ç³»ç»Ÿ
- âœ… ç±»å‹å®‰å…¨ï¼ˆTypeScriptï¼‰

**ç¼ºç‚¹**ï¼š
- âŒ è¿è¡Œæ—¶æ€§èƒ½å¼€é”€
- âŒ è°ƒè¯•å›°éš¾
- âŒ SSR å¤æ‚åº¦å¢åŠ 
- âŒ å­¦ä¹ æˆæœ¬é«˜

### 3. Shadow DOM

**åŸç†**ï¼šåˆ©ç”¨æµè§ˆå™¨åŸç”Ÿçš„ Shadow DOM ç‰¹æ€§å®ç°æ ·å¼éš”ç¦»

```javascript
class CustomButton extends HTMLElement {
  constructor() {
    super();
    
    // åˆ›å»º Shadow DOM
    const shadow = this.attachShadow({ mode: 'closed' });
    
    // åˆ›å»ºæ ·å¼
    const style = document.createElement('style');
    style.textContent = `
      button {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
      }
      
      button:hover {
        opacity: 0.8;
      }
    `;
    
    // åˆ›å»ºæŒ‰é’®
    const button = document.createElement('button');
    button.textContent = this.getAttribute('text') || 'Click me';
    
    // æ·»åŠ åˆ° Shadow DOM
    shadow.appendChild(style);
    shadow.appendChild(button);
  }
}

customElements.define('custom-button', CustomButton);
```

```html
<!-- ä½¿ç”¨ -->
<custom-button text="æˆ‘çš„æŒ‰é’®"></custom-button>
```

**ä¼˜ç‚¹**ï¼š
- âœ… æµè§ˆå™¨åŸç”Ÿæ”¯æŒ
- âœ… å®Œå…¨éš”ç¦»
- âœ… æ— æ„å»ºä¾èµ–
- âœ… æ€§èƒ½ä¼˜ç§€

**ç¼ºç‚¹**ï¼š
- âŒ å…¼å®¹æ€§é™åˆ¶
- âŒ è°ƒè¯•å›°éš¾
- âŒ æ ·å¼ç©¿é€å¤æ‚
- âŒ æ¡†æ¶é›†æˆå¤æ‚

### 4. BEM å‘½åè§„èŒƒ

**åŸç†**ï¼šé€šè¿‡ä¸¥æ ¼çš„å‘½åè§„èŒƒé¿å…æ ·å¼å†²çª

```css
/* Block */
.card {
  border: 1px solid #ddd;
  border-radius: 4px;
}

/* Element */
.card__header {
  padding: 15px;
  background-color: #f5f5f5;
  border-bottom: 1px solid #ddd;
}

.card__body {
  padding: 15px;
}

.card__footer {
  padding: 15px;
  background-color: #f5f5f5;
  border-top: 1px solid #ddd;
}

/* Modifier */
.card--large {
  min-height: 300px;
}

.card--primary {
  border-color: #007bff;
}

.card__header--primary {
  background-color: #007bff;
  color: white;
}
```

```html
<div class="card card--large card--primary">
  <div class="card__header card__header--primary">
    å¡ç‰‡æ ‡é¢˜
  </div>
  <div class="card__body">
    å¡ç‰‡å†…å®¹
  </div>
  <div class="card__footer">
    å¡ç‰‡åº•éƒ¨
  </div>
</div>
```

**ä¼˜ç‚¹**ï¼š
- âœ… æ— æŠ€æœ¯ä¾èµ–
- âœ… è¯­ä¹‰æ¸…æ™°
- âœ… æ˜“äºç†è§£å’Œç»´æŠ¤
- âœ… å›¢é˜Ÿåä½œå‹å¥½

**ç¼ºç‚¹**ï¼š
- âŒ ç±»åå†—é•¿
- âŒ ä¾èµ–å¼€å‘è€…è‡ªè§‰æ€§
- âŒ ä¸èƒ½å®Œå…¨é¿å…å†²çª
- âŒ é‡æ„å›°éš¾

### 5. å‘½åç©ºé—´

**åŸç†**ï¼šä¸ºä¸åŒæ¨¡å—/åº”ç”¨æ·»åŠ ç»Ÿä¸€å‰ç¼€

```css
/* åº”ç”¨ A */
.app-a-header {
  background-color: blue;
}

.app-a-button {
  background-color: #007bff;
}

/* åº”ç”¨ B */
.app-b-header {
  background-color: red;
}

.app-b-button {
  background-color: #28a745;
}
```

**è‡ªåŠ¨åŒ–å‘½åç©ºé—´**ï¼š

```scss
// ä½¿ç”¨ SCSS åµŒå¥—
.app-a {
  .header {
    background-color: blue;
  }
  
  .button {
    background-color: #007bff;
  }
}
```

**PostCSS æ’ä»¶ç¤ºä¾‹**ï¼š

```javascript
// postcss.config.js
module.exports = {
  plugins: [
    require('postcss-prefixwrap')('.app-namespace')
  ]
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… ç®€å•æ˜“å®ç°
- âœ… æ— è¿è¡Œæ—¶å¼€é”€
- âœ… å…¼å®¹æ€§å¥½
- âœ… è°ƒè¯•å‹å¥½

**ç¼ºç‚¹**ï¼š
- âŒ ç±»åå†—é•¿
- âŒ éœ€è¦å›¢é˜Ÿçº¦å®š
- âŒ åµŒå¥—å±‚çº§å¯èƒ½è¿‡æ·±
- âŒ ç¬¬ä¸‰æ–¹åº“å¤„ç†å›°éš¾

### 6. å¾®å‰ç«¯æ ·å¼éš”ç¦»

#### qiankun æ ·å¼éš”ç¦»

```javascript
// ä¸¥æ ¼æ ·å¼éš”ç¦»
import { registerMicroApps, start } from 'qiankun';

registerMicroApps([
  {
    name: 'react-app',
    entry: '//localhost:3000',
    container: '#react-container',
    activeRule: '/react',
    sandbox: {
      strictStyleIsolation: true, // å¼€å¯ä¸¥æ ¼æ ·å¼éš”ç¦»
    },
  },
]);

start();
```

#### single-spa æ ·å¼éš”ç¦»

```javascript
// åº”ç”¨çº§åˆ«çš„æ ·å¼éš”ç¦»
export const mount = (props) => {
  // æ·»åŠ åº”ç”¨ç‰¹å®šçš„æ ·å¼å‰ç¼€
  const styleElement = document.createElement('style');
  styleElement.innerHTML = `
    .${props.appName} .header { 
      background-color: blue; 
    }
  `;
  document.head.appendChild(styleElement);
  
  return Promise.resolve();
};

export const unmount = (props) => {
  // æ¸…ç†æ ·å¼
  const styles = document.querySelectorAll(`style[data-app="${props.appName}"]`);
  styles.forEach(style => style.remove());
  
  return Promise.resolve();
};
```

## æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | éš”ç¦»ç¨‹åº¦ | æ€§èƒ½ | å­¦ä¹ æˆæœ¬ | æ„å»ºå¤æ‚åº¦ | è°ƒè¯•éš¾åº¦ | é€‚ç”¨åœºæ™¯ |
|------|----------|------|----------|------------|----------|----------|
| CSS Modules | é«˜ | é«˜ | ä½ | ä¸­ | ä½ | ç»„ä»¶åº“ã€React/Vue é¡¹ç›® |
| CSS-in-JS | é«˜ | ä¸­ | ä¸­ | ä¸­ | ä¸­ | React ç”Ÿæ€ã€åŠ¨æ€ä¸»é¢˜ |
| Shadow DOM | æœ€é«˜ | é«˜ | é«˜ | ä½ | é«˜ | Web Components |
| BEM | ä¸­ | é«˜ | ä½ | ä½ | ä½ | ä¼ ç»Ÿé¡¹ç›®ã€å›¢é˜Ÿåä½œ |
| å‘½åç©ºé—´ | ä¸­ | é«˜ | ä½ | ä½ | ä½ | å¾®å‰ç«¯ã€å¤šåº”ç”¨ |

## æœ€ä½³å®è·µ

### 1. ç»„åˆä½¿ç”¨å¤šç§æ–¹æ¡ˆ

```javascript
// ä¸»åº”ç”¨ï¼šä½¿ç”¨å‘½åç©ºé—´ + CSS Modules
// å­åº”ç”¨ï¼šä½¿ç”¨ CSS-in-JS + BEM

// ä¸»åº”ç”¨
import styles from './App.module.css';

function App() {
  return (
    <div className={`main-app ${styles.container}`}>
      {/* å†…å®¹ */}
    </div>
  );
}

// å­åº”ç”¨
const StyledComponent = styled.div`
  .sub-app__content {
    /* BEM å‘½å + CSS-in-JS */
  }
`;
```

### 2. å·¥ç¨‹åŒ–é…ç½®

#### Webpack é…ç½®

```javascript
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.module\.css$/,
        use: [
          'style-loader',
          {
            loader: 'css-loader',
            options: {
              modules: {
                localIdentName: '[path][name]__[local]--[hash:base64:5]',
              },
            },
          },
        ],
      },
    ],
  },
};
```

#### PostCSS é…ç½®

```javascript
// postcss.config.js
module.exports = {
  plugins: [
    require('autoprefixer'),
    require('postcss-nested'),
    require('postcss-prefixwrap')('.app-prefix'),
  ],
};
```

### 3. å›¢é˜Ÿåä½œè§„èŒƒ

#### æ ·å¼å‘½åè§„èŒƒ

```yaml
# å›¢é˜Ÿæ ·å¼è§„èŒƒ
naming_convention:
  - ä½¿ç”¨ kebab-case
  - ç»„ä»¶åä½œä¸ºå‰ç¼€
  - çŠ¶æ€ä½¿ç”¨ is- å‰ç¼€
  - ä¿®é¥°ç¬¦ä½¿ç”¨ -- è¿æ¥

# ç¤ºä¾‹
button-component:
  - .button-component
  - .button-component--primary
  - .button-component--large
  - .button-component.is-loading
```

#### Git Hook æ£€æŸ¥

```javascript
// .husky/pre-commit
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# æ£€æŸ¥æ ·å¼å‘½åè§„èŒƒ
npx stylelint "**/*.css" "**/*.scss"

# æ£€æŸ¥ CSS Modules ä½¿ç”¨
node scripts/check-css-modules.js
```

### 4. å¾®å‰ç«¯åœºæ™¯å®è·µ

#### ä¸»åº”ç”¨æ ·å¼ç®¡ç†

```javascript
// ä¸»åº”ç”¨æ ·å¼ç®¡ç†å™¨
class StyleManager {
  constructor() {
    this.appStyles = new Map();
  }
  
  // æ³¨å†Œåº”ç”¨æ ·å¼
  registerApp(appName, styleUrls) {
    const styles = styleUrls.map(url => {
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = url;
      link.setAttribute('data-app', appName);
      return link;
    });
    
    this.appStyles.set(appName, styles);
    styles.forEach(style => document.head.appendChild(style));
  }
  
  // å¸è½½åº”ç”¨æ ·å¼
  unregisterApp(appName) {
    const styles = this.appStyles.get(appName) || [];
    styles.forEach(style => style.remove());
    this.appStyles.delete(appName);
  }
}

// ä½¿ç”¨
const styleManager = new StyleManager();

// å¾®åº”ç”¨åŠ è½½æ—¶
styleManager.registerApp('app-a', [
  'http://localhost:3001/static/css/main.css'
]);

// å¾®åº”ç”¨å¸è½½æ—¶
styleManager.unregisterApp('app-a');
```

## æ€§èƒ½ä¼˜åŒ–

### 1. CSS æå–å’Œå‹ç¼©

```javascript
// webpack.config.js
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin');

module.exports = {
  plugins: [
    new MiniCssExtractPlugin({
      filename: '[name].[contenthash].css',
    }),
  ],
  optimization: {
    minimizer: [
      new CssMinimizerPlugin(),
    ],
  },
};
```

### 2. è¿è¡Œæ—¶æ ·å¼ä¼˜åŒ–

```javascript
// å»¶è¿ŸåŠ è½½æ ·å¼
const loadStyleAsync = (href) => {
  return new Promise((resolve, reject) => {
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = href;
    link.onload = resolve;
    link.onerror = reject;
    document.head.appendChild(link);
  });
};

// æ¡ä»¶åŠ è½½
if (shouldLoadTheme) {
  loadStyleAsync('/themes/dark.css');
}
```

## è°ƒè¯•å’Œç›‘æ§

### 1. æ ·å¼å†²çªæ£€æµ‹

```javascript
// æ ·å¼å†²çªæ£€æµ‹å·¥å…·
class StyleConflictDetector {
  constructor() {
    this.styleRules = new Map();
  }
  
  // æ£€æµ‹é‡å¤æ ·å¼
  detectConflicts() {
    const sheets = Array.from(document.styleSheets);
    const conflicts = [];
    
    sheets.forEach(sheet => {
      try {
        Array.from(sheet.cssRules).forEach(rule => {
          if (rule.selectorText) {
            const existing = this.styleRules.get(rule.selectorText);
            if (existing) {
              conflicts.push({
                selector: rule.selectorText,
                sources: [existing.source, sheet.href || 'inline'],
              });
            } else {
              this.styleRules.set(rule.selectorText, {
                rule,
                source: sheet.href || 'inline',
              });
            }
          }
        });
      } catch (e) {
        // è·¨åŸŸæ ·å¼è¡¨æ— æ³•è®¿é—®
      }
    });
    
    return conflicts;
  }
}

// ä½¿ç”¨
const detector = new StyleConflictDetector();
console.log('æ ·å¼å†²çª:', detector.detectConflicts());
```

### 2. å¼€å‘å·¥å…·

```javascript
// Chrome æ‰©å±• - æ ·å¼éš”ç¦»æ£€æŸ¥å™¨
const inspectStyles = () => {
  const elements = document.querySelectorAll('*');
  const report = [];
  
  elements.forEach(el => {
    const styles = getComputedStyle(el);
    const classNames = Array.from(el.classList);
    
    // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†éš”ç¦»æ–¹æ¡ˆ
    const hasModuleClass = classNames.some(cls => cls.includes('__'));
    const hasNamespace = classNames.some(cls => cls.startsWith('app-'));
    
    if (!hasModuleClass && !hasNamespace && classNames.length > 0) {
      report.push({
        element: el.tagName,
        classes: classNames,
        warning: 'å¯èƒ½å­˜åœ¨æ ·å¼å†²çªé£é™©',
      });
    }
  });
  
  return report;
};
```

## æ€»ç»“

æ ·å¼éš”ç¦»æ˜¯å‰ç«¯å·¥ç¨‹åŒ–ä¸­çš„é‡è¦ç¯èŠ‚ï¼Œä¸åŒçš„æ–¹æ¡ˆå„æœ‰ä¼˜åŠ£ï¼š

### é€‰æ‹©å»ºè®®

1. **å°å‹é¡¹ç›®**ï¼šBEM + å‘½åç©ºé—´
2. **React/Vue ç»„ä»¶åº“**ï¼šCSS Modules
3. **å¤æ‚äº¤äº’åº”ç”¨**ï¼šCSS-in-JS
4. **å¾®å‰ç«¯æ¶æ„**ï¼šå‘½åç©ºé—´ + æ²™ç®±éš”ç¦»
5. **Web Components**ï¼šShadow DOM

### æ ¸å¿ƒåŸåˆ™

- **æ¸è¿›å¼**ï¼šä»ç®€å•æ–¹æ¡ˆå¼€å§‹ï¼Œé€æ­¥å¼•å…¥å¤æ‚æ–¹æ¡ˆ
- **å›¢é˜Ÿåä½œ**ï¼šç»Ÿä¸€è§„èŒƒæ¯”æŠ€æœ¯æ–¹æ¡ˆæ›´é‡è¦
- **æ€§èƒ½ä¼˜å…ˆ**ï¼šé¿å…è¿‡åº¦å·¥ç¨‹åŒ–å½±å“æ€§èƒ½
- **å¯ç»´æŠ¤æ€§**ï¼šé€‰æ‹©å›¢é˜Ÿèƒ½å¤Ÿé•¿æœŸç»´æŠ¤çš„æ–¹æ¡ˆ

æ ·å¼éš”ç¦»ä¸æ˜¯é“¶å¼¹ï¼Œéœ€è¦ç»“åˆé¡¹ç›®å®é™…æƒ…å†µå’Œå›¢é˜ŸæŠ€æœ¯æ ˆæ¥é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚åœ¨å®æ–½è¿‡ç¨‹ä¸­ï¼Œè¦æ³¨é‡å·¥å…·é“¾çš„å®Œå–„å’Œå›¢é˜Ÿè§„èŒƒçš„å»ºç«‹ï¼Œç¡®ä¿æ–¹æ¡ˆèƒ½å¤ŸçœŸæ­£è§£å†³é—®é¢˜è€Œä¸æ˜¯å¢åŠ å¤æ‚åº¦ã€‚

---

*æŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿è¡¥å……æ›´å¤šå®è·µç»éªŒ...*
