# 微前端监控与调试

微前端的监控与调试对于保证系统稳定性和开发效率至关重要。本文介绍监控体系建设和调试工具的实现。

## 应用监控

### 监控系统

```javascript
// 微前端监控系统
class MicroAppMonitor {
  constructor() {
    this.metrics = {
      loadTimes: {},
      errors: [],
      performance: {},
    };
  }
  
  // 记录加载时间
  recordLoadTime(appName, startTime, endTime) {
    const loadTime = endTime - startTime;
    this.metrics.loadTimes[appName] = loadTime;
    
    // 发送到监控系统
    this.sendMetrics('load_time', {
      app: appName,
      duration: loadTime,
      timestamp: endTime,
    });
  }
  
  // 记录错误
  recordError(appName, error) {
    const errorInfo = {
      app: appName,
      message: error.message,
      stack: error.stack,
      timestamp: Date.now(),
    };
    
    this.metrics.errors.push(errorInfo);
    this.sendMetrics('error', errorInfo);
  }
  
  // 发送指标
  sendMetrics(type, data) {
    fetch('/api/metrics', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ type, data }),
    });
  }
}

// 全局监控实例
window.microAppMonitor = new MicroAppMonitor();
```

## 调试工具

### 调试面板

```javascript
// 微前端调试面板
class DebugPanel {
  constructor() {
    this.panel = null;
    this.isVisible = false;
  }
  
  // 创建调试面板
  create() {
    this.panel = document.createElement('div');
    this.panel.id = 'micro-app-debug';
    this.panel.innerHTML = `
      <div class="debug-header">
        <h3>微前端调试面板</h3>
        <button onclick="debugPanel.toggle()">收起</button>
      </div>
      <div class="debug-content">
        <div class="debug-section">
          <h4>已注册应用</h4>
          <div id="registered-apps"></div>
        </div>
        <div class="debug-section">
          <h4>当前活跃应用</h4>
          <div id="active-apps"></div>
        </div>
        <div class="debug-section">
          <h4>性能指标</h4>
          <div id="performance-metrics"></div>
        </div>
      </div>
    `;
    
    document.body.appendChild(this.panel);
    this.updateInfo();
  }
}

// 创建全局调试面板
const debugPanel = new DebugPanel();
if (process.env.NODE_ENV === 'development') {
  debugPanel.create();
}
```

## 错误边界

### React 错误边界

```javascript
// React 错误边界
class MicroAppErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null };
  }
  
  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }
  
  componentDidCatch(error, errorInfo) {
    // 记录错误信息
    window.microAppMonitor.recordError(this.props.appName, error);
    
    // 发送错误报告
    console.error(`微应用 ${this.props.appName} 发生错误:`, error, errorInfo);
  }
  
  render() {
    if (this.state.hasError) {
      return (
        <div className="micro-app-error">
          <h3>应用加载失败</h3>
          <p>应用 {this.props.appName} 出现了错误</p>
          <button onClick={() => window.location.reload()}>
            重新加载
          </button>
        </div>
      );
    }
    
    return this.props.children;
  }
}
```

---

**完整监控调试内容请参考原文档**

**下一步**：了解 [最佳实践](./08-最佳实践.md) 的详细指南
