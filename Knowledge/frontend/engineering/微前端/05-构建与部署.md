# 微前端构建与部署

微前端的构建与部署是实现独立开发、独立部署的关键环节。本文介绍如何搭建完整的构建部署体系。

## 独立构建流水线

### GitHub Actions 配置

```yaml
# .github/workflows/micro-app.yml
name: Micro Frontend Build

on:
  push:
    paths:
      - 'apps/**'

jobs:
  build-main-app:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'
      - name: Install dependencies
        run: cd apps/main && npm ci
      - name: Build
        run: cd apps/main && npm run build
      - name: Deploy
        run: cd apps/main && npm run deploy

  build-react-app:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'
      - name: Install dependencies
        run: cd apps/react-app && npm ci
      - name: Build
        run: cd apps/react-app && npm run build
      - name: Deploy
        run: cd apps/react-app && npm run deploy
```

## 版本管理

```javascript
// 版本管理配置
const microApps = [
  {
    name: 'react-app',
    entry: getAppEntry('react-app', process.env.REACT_APP_VERSION),
    activeRule: '/react',
  },
  {
    name: 'vue-app',
    entry: getAppEntry('vue-app', process.env.VUE_APP_VERSION),
    activeRule: '/vue',
  },
];

function getAppEntry(appName, version = 'latest') {
  const baseUrl = process.env.MICRO_APP_BASE_URL;
  return `${baseUrl}/${appName}/${version}/`;
}

// 应用注册表
const appRegistry = {
  'react-app': {
    versions: ['1.0.0', '1.1.0', '1.2.0'],
    latest: '1.2.0',
    stable: '1.1.0',
  },
  'vue-app': {
    versions: ['2.0.0', '2.1.0'],
    latest: '2.1.0',
    stable: '2.0.0',
  },
};
```

## 环境配置

```javascript
// 环境配置管理
class EnvironmentConfig {
  constructor() {
    this.env = process.env.NODE_ENV || 'development';
    this.configs = {
      development: {
        'react-app': 'http://localhost:3001',
        'vue-app': 'http://localhost:3002',
      },
      staging: {
        'react-app': 'https://staging-react.example.com',
        'vue-app': 'https://staging-vue.example.com',
      },
      production: {
        'react-app': 'https://react.example.com',
        'vue-app': 'https://vue.example.com',
      },
    };
  }
  
  getAppEntry(appName) {
    return this.configs[this.env][appName];
  }
  
  getAllApps() {
    return Object.keys(this.configs[this.env]).map(name => ({
      name,
      entry: this.getAppEntry(name),
      activeRule: `/${name}`,
    }));
  }
}

const envConfig = new EnvironmentConfig();
```

---

**完整内容请参考原文档中的构建部署部分**

**下一步**：了解 [性能优化](./06-性能优化.md) 的具体方案
