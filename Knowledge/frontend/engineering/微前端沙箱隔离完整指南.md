# å¾®å‰ç«¯æ²™ç®±éš”ç¦»å®Œæ•´æŒ‡å—

å¾®å‰ç«¯æ¶æ„ä¸­æœ€å…³é”®çš„æŠ€æœ¯æŒ‘æˆ˜ä¹‹ä¸€å°±æ˜¯åº”ç”¨é—´çš„éš”ç¦»é—®é¢˜ã€‚æœ¬æ–‡è¯¦ç»†ä»‹ç»å¦‚ä½•å®ç°ä¸€å¥—å®Œæ•´ã€å¯é ã€é«˜æ€§èƒ½çš„æ²™ç®±éš”ç¦»æ–¹æ¡ˆã€‚

## ğŸ“‹ ç›®å½•

- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [JavaScript æ²™ç®±](#javascript-æ²™ç®±)
- [CSS æ ·å¼éš”ç¦»](#css-æ ·å¼éš”ç¦»)
- [èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†](#èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†)
- [äº‹ä»¶å’Œå†…å­˜ç®¡ç†](#äº‹ä»¶å’Œå†…å­˜ç®¡ç†)
- [å®Œæ•´æ²™ç®±å®ç°](#å®Œæ•´æ²™ç®±å®ç°)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## æ ¸å¿ƒæ¦‚å¿µ

### æ²™ç®±éš”ç¦»çš„å¿…è¦æ€§

åœ¨å¾®å‰ç«¯æ¶æ„ä¸­ï¼Œå¤šä¸ªç‹¬ç«‹çš„åº”ç”¨è¿è¡Œåœ¨åŒä¸€ä¸ªé¡µé¢ç¯å¢ƒä¸­ï¼Œä¼šé¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š

```javascript
// é—®é¢˜ç¤ºä¾‹ï¼šå…¨å±€å˜é‡å†²çª
// ä¸»åº”ç”¨
window.userInfo = { name: 'admin', role: 'admin' };
window.config = { theme: 'light', version: '1.0' };

// å­åº”ç”¨ A
window.userInfo = { name: 'user1', role: 'user' };  // âŒ è¦†ç›–ä¸»åº”ç”¨
window.config.theme = 'dark';                       // âŒ ä¿®æ”¹ä¸»åº”ç”¨é…ç½®
window.appAData = 'sensitive data';                 // âŒ æ±¡æŸ“å…¨å±€

// å­åº”ç”¨ B å—åˆ°å½±å“
console.log(window.userInfo);  // ä¸æ˜¯æœŸæœ›çš„å€¼
console.log(window.config);    // è¢«ä¿®æ”¹çš„é…ç½®
```

### éš”ç¦»åŸåˆ™

1. **çŠ¶æ€éš”ç¦»**ï¼šæ¯ä¸ªåº”ç”¨æœ‰ç‹¬ç«‹çš„å…¨å±€çŠ¶æ€
2. **æ ·å¼éš”ç¦»**ï¼šCSS è§„åˆ™ä¸ä¼šç›¸äº’å½±å“
3. **äº‹ä»¶éš”ç¦»**ï¼šäº‹ä»¶ç›‘å¬å™¨ä¸ä¼šæ³„æ¼
4. **èµ„æºéš”ç¦»**ï¼šåŠ¨æ€åŠ è½½çš„èµ„æºèƒ½å¤Ÿæ­£ç¡®æ¸…ç†
5. **å‰¯ä½œç”¨éš”ç¦»**ï¼šå®šæ—¶å™¨ã€ç½‘ç»œè¯·æ±‚ç­‰å‰¯ä½œç”¨èƒ½å¤Ÿå®Œå…¨æ¸…ç†

## JavaScript æ²™ç®±

### 1. å¿«ç…§æ²™ç®±ï¼ˆSnapshotSandboxï¼‰

é€‚ç”¨äºå•å®ä¾‹åœºæ™¯ï¼Œé€šè¿‡è®°å½•å’Œæ¢å¤ window å¯¹è±¡çš„å¿«ç…§æ¥å®ç°éš”ç¦»ã€‚

```javascript
/**
 * å¿«ç…§æ²™ç®± - é€‚ç”¨äºå•å®ä¾‹åº”ç”¨
 * åŸç†ï¼šè®°å½•æ¿€æ´»å‰çš„ window çŠ¶æ€ï¼Œæ¢å¤æ—¶å›æ»šæ‰€æœ‰å˜æ›´
 */
class SnapshotSandbox {
  constructor(name) {
    this.name = name;
    this.windowSnapshot = {};
    this.modifyPropsMap = {};
    this.active = false;
  }

  /**
   * æ¿€æ´»æ²™ç®±
   */
  activate() {
    if (this.active) return;

    // è®°å½•å½“å‰ window çŠ¶æ€å¿«ç…§
    this.windowSnapshot = {};
    for (const prop in window) {
      if (window.hasOwnProperty(prop)) {
        this.windowSnapshot[prop] = window[prop];
      }
    }

    // æ¢å¤ä¹‹å‰çš„ä¿®æ”¹
    Object.keys(this.modifyPropsMap).forEach(prop => {
      window[prop] = this.modifyPropsMap[prop];
    });

    this.active = true;
    console.log(`ğŸŸ¢ ${this.name} æ²™ç®±å·²æ¿€æ´»`);
  }

  /**
   * å¤±æ´»æ²™ç®±
   */
  deactivate() {
    if (!this.active) return;

    // è®°å½•æœ¬æ¬¡è¿è¡Œä¸­çš„ä¿®æ”¹
    this.modifyPropsMap = {};
    for (const prop in window) {
      if (window.hasOwnProperty(prop)) {
        if (window[prop] !== this.windowSnapshot[prop]) {
          // è®°å½•è¢«ä¿®æ”¹çš„å±æ€§
          this.modifyPropsMap[prop] = window[prop];
          // æ¢å¤åˆ°æ¿€æ´»å‰çš„çŠ¶æ€
          window[prop] = this.windowSnapshot[prop];
        }
      }
    }

    // å¤„ç†æ–°å¢çš„å±æ€§
    for (const prop in window) {
      if (window.hasOwnProperty(prop) && !(prop in this.windowSnapshot)) {
        // è®°å½•æ–°å¢çš„å±æ€§
        this.modifyPropsMap[prop] = window[prop];
        // åˆ é™¤æ–°å¢çš„å±æ€§
        delete window[prop];
      }
    }

    this.active = false;
    console.log(`ğŸ”´ ${this.name} æ²™ç®±å·²å¤±æ´»`);
  }

  /**
   * è·å–æ²™ç®±çŠ¶æ€
   */
  getStatus() {
    return {
      name: this.name,
      active: this.active,
      modifiedProps: Object.keys(this.modifyPropsMap).length,
      snapshotSize: Object.keys(this.windowSnapshot).length
    };
  }
}
```

### 2. ä»£ç†æ²™ç®±ï¼ˆProxySandboxï¼‰

é€‚ç”¨äºå¤šå®ä¾‹åœºæ™¯ï¼Œé€šè¿‡ Proxy æ‹¦æˆªå¯¹ window çš„è®¿é—®ï¼Œæ¯ä¸ªåº”ç”¨æœ‰ç‹¬ç«‹çš„å±æ€§ç©ºé—´ã€‚

```javascript
/**
 * ä»£ç†æ²™ç®± - é€‚ç”¨äºå¤šå®ä¾‹åº”ç”¨
 * åŸç†ï¼šé€šè¿‡ Proxy æ‹¦æˆª window è®¿é—®ï¼Œä¸ºæ¯ä¸ªåº”ç”¨åˆ›å»ºç‹¬ç«‹çš„å±æ€§ç©ºé—´
 */
class ProxySandbox {
  constructor(name) {
    this.name = name;
    this.fakeWindow = {};
    this.active = false;
    this.injectedKeys = new Set();
    
    // åˆ›å»ºä»£ç† window
    this.proxyWindow = this.createProxyWindow();
  }

  /**
   * åˆ›å»ºä»£ç† window å¯¹è±¡
   */
  createProxyWindow() {
    const { fakeWindow, injectedKeys } = this;
    const descriptorTargetMap = new Map();
    
    return new Proxy(fakeWindow, {
      set: (target, prop, value, receiver) => {
        if (this.active) {
          if (!target.hasOwnProperty(prop) && window.hasOwnProperty(prop)) {
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®¾ç½®ä¸”åŸ window ä¸Šå­˜åœ¨è¯¥å±æ€§ï¼Œè®°å½•åŸå§‹æè¿°ç¬¦
            const descriptor = Object.getOwnPropertyDescriptor(window, prop);
            if (descriptor && !descriptor.configurable) {
              // ä¸å¯é…ç½®çš„å±æ€§ä¸èƒ½è¢«ä»£ç†
              console.warn(`å±æ€§ ${prop} ä¸å¯é…ç½®ï¼Œæ— æ³•ä»£ç†`);
              return false;
            }
            descriptorTargetMap.set(prop, descriptor);
          }
          
          injectedKeys.add(prop);
          target[prop] = value;
          
          console.log(`ğŸ“ ${this.name} è®¾ç½®å±æ€§: ${prop}`, value);
          return true;
        }
        
        console.warn(`âš ï¸ ${this.name} æ²™ç®±æœªæ¿€æ´»ï¼Œå¿½ç•¥è®¾ç½®: ${prop}`);
        return true;
      },

      get: (target, prop, receiver) => {
        // ä¼˜å…ˆä»æ²™ç®±è·å–
        if (prop in target) {
          return target[prop];
        }

        // ä»åŸå§‹ window è·å–
        const value = window[prop];
        
        // ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘åŸå§‹ window
        if (typeof value === 'function' && !this.isConstructor(value)) {
          return value.bind(window);
        }

        return value;
      },

      has: (target, prop) => {
        return prop in target || prop in window;
      },

      getOwnPropertyDescriptor: (target, prop) => {
        if (target.hasOwnProperty(prop)) {
          return Object.getOwnPropertyDescriptor(target, prop);
        }
        
        if (descriptorTargetMap.has(prop)) {
          return descriptorTargetMap.get(prop);
        }
        
        return Object.getOwnPropertyDescriptor(window, prop);
      },

      defineProperty: (target, prop, descriptor) => {
        if (this.active) {
          injectedKeys.add(prop);
          return Reflect.defineProperty(target, prop, descriptor);
        }
        return true;
      },

      deleteProperty: (target, prop) => {
        if (this.active) {
          injectedKeys.add(prop);
          return Reflect.deleteProperty(target, prop);
        }
        return true;
      },

      ownKeys: (target) => {
        return Reflect.ownKeys(window).concat(Reflect.ownKeys(target));
      }
    });
  }

  /**
   * åˆ¤æ–­æ˜¯å¦ä¸ºæ„é€ å‡½æ•°
   */
  isConstructor(fn) {
    const functionStr = fn.toString();
    return /^class\s/.test(functionStr) || /^function\s+[A-Z]/.test(functionStr);
  }

  /**
   * æ¿€æ´»æ²™ç®±
   */
  activate() {
    if (this.active) return;
    
    this.active = true;
    console.log(`ğŸŸ¢ ${this.name} ä»£ç†æ²™ç®±å·²æ¿€æ´»`);
  }

  /**
   * å¤±æ´»æ²™ç®±
   */
  deactivate() {
    if (!this.active) return;
    
    this.active = false;
    console.log(`ğŸ”´ ${this.name} ä»£ç†æ²™ç®±å·²å¤±æ´»`);
  }

  /**
   * è·å–ä»£ç† window
   */
  getProxyWindow() {
    return this.proxyWindow;
  }

  /**
   * æ¸…ç†æ²™ç®±
   */
  destroy() {
    this.deactivate();
    this.fakeWindow = {};
    this.injectedKeys.clear();
    console.log(`ğŸ—‘ï¸ ${this.name} æ²™ç®±å·²é”€æ¯`);
  }

  /**
   * è·å–æ²™ç®±çŠ¶æ€
   */
  getStatus() {
    return {
      name: this.name,
      active: this.active,
      injectedKeys: Array.from(this.injectedKeys),
      fakeWindowKeys: Object.keys(this.fakeWindow)
    };
  }
}
```

### 3. åŸç”Ÿæ²™ç®±ï¼ˆNativeSandboxï¼‰

ä½¿ç”¨ iframe æˆ– Web Workers åˆ›å»ºçœŸæ­£çš„éš”ç¦»ç¯å¢ƒã€‚

```javascript
/**
 * åŸç”Ÿæ²™ç®± - ä½¿ç”¨ iframe å®ç°çœŸæ­£çš„éš”ç¦»
 */
class NativeSandbox {
  constructor(name) {
    this.name = name;
    this.iframe = null;
    this.sandboxWindow = null;
    this.active = false;
    this.messageHandlers = new Map();
  }

  /**
   * åˆ›å»ºæ²™ç®±ç¯å¢ƒ
   */
  async create() {
    return new Promise((resolve, reject) => {
      // åˆ›å»ºéšè—çš„ iframe
      this.iframe = document.createElement('iframe');
      this.iframe.style.display = 'none';
      this.iframe.src = 'about:blank';
      
      this.iframe.onload = () => {
        try {
          this.sandboxWindow = this.iframe.contentWindow;
          this.setupSandboxEnvironment();
          console.log(`ğŸ—ï¸ ${this.name} åŸç”Ÿæ²™ç®±åˆ›å»ºæˆåŠŸ`);
          resolve(this.sandboxWindow);
        } catch (error) {
          console.error(`âŒ ${this.name} åŸç”Ÿæ²™ç®±åˆ›å»ºå¤±è´¥:`, error);
          reject(error);
        }
      };

      this.iframe.onerror = reject;
      document.body.appendChild(this.iframe);
    });
  }

  /**
   * è®¾ç½®æ²™ç®±ç¯å¢ƒ
   */
  setupSandboxEnvironment() {
    if (!this.sandboxWindow) return;

    // æ³¨å…¥å¿…è¦çš„å…¨å±€å¯¹è±¡
    this.sandboxWindow.console = window.console;
    this.sandboxWindow.fetch = window.fetch.bind(window);
    this.sandboxWindow.setTimeout = window.setTimeout.bind(window);
    this.sandboxWindow.setInterval = window.setInterval.bind(window);
    this.sandboxWindow.clearTimeout = window.clearTimeout.bind(window);
    this.sandboxWindow.clearInterval = window.clearInterval.bind(window);
    
    // è®¾ç½®é€šä¿¡æœºåˆ¶
    this.setupCommunication();
    
    // æ³¨å…¥æ²™ç®±æ ‡è¯†
    this.sandboxWindow.__SANDBOX_NAME__ = this.name;
    this.sandboxWindow.__IS_SANDBOX__ = true;
  }

  /**
   * è®¾ç½®é€šä¿¡æœºåˆ¶
   */
  setupCommunication() {
    // ç›‘å¬æ¥è‡ªæ²™ç®±çš„æ¶ˆæ¯
    window.addEventListener('message', (event) => {
      if (event.source === this.sandboxWindow) {
        const { type, data, id } = event.data;
        
        if (this.messageHandlers.has(type)) {
          const handler = this.messageHandlers.get(type);
          const result = handler(data);
          
          // å‘é€å“åº”
          this.sandboxWindow.postMessage({
            type: 'response',
            id,
            data: result
          }, '*');
        }
      }
    });

    // ä¸ºæ²™ç®±æ³¨å…¥é€šä¿¡æ–¹æ³•
    this.sandboxWindow.sendToHost = (type, data) => {
      return new Promise((resolve) => {
        const id = Math.random().toString(36).substr(2, 9);
        
        const responseHandler = (event) => {
          if (event.data.type === 'response' && event.data.id === id) {
            window.removeEventListener('message', responseHandler);
            resolve(event.data.data);
          }
        };
        
        window.addEventListener('message', responseHandler);
        
        window.postMessage({
          type,
          data,
          id
        }, '*');
      });
    };
  }

  /**
   * æ³¨å†Œæ¶ˆæ¯å¤„ç†å™¨
   */
  onMessage(type, handler) {
    this.messageHandlers.set(type, handler);
  }

  /**
   * åœ¨æ²™ç®±ä¸­æ‰§è¡Œä»£ç 
   */
  execute(code) {
    if (!this.sandboxWindow) {
      throw new Error('æ²™ç®±æœªåˆ›å»º');
    }

    try {
      return this.sandboxWindow.eval(code);
    } catch (error) {
      console.error(`${this.name} ä»£ç æ‰§è¡Œå¤±è´¥:`, error);
      throw error;
    }
  }

  /**
   * æ¿€æ´»æ²™ç®±
   */
  activate() {
    this.active = true;
    console.log(`ğŸŸ¢ ${this.name} åŸç”Ÿæ²™ç®±å·²æ¿€æ´»`);
  }

  /**
   * å¤±æ´»æ²™ç®±
   */
  deactivate() {
    this.active = false;
    console.log(`ğŸ”´ ${this.name} åŸç”Ÿæ²™ç®±å·²å¤±æ´»`);
  }

  /**
   * é”€æ¯æ²™ç®±
   */
  destroy() {
    if (this.iframe && this.iframe.parentNode) {
      this.iframe.parentNode.removeChild(this.iframe);
    }
    
    this.iframe = null;
    this.sandboxWindow = null;
    this.messageHandlers.clear();
    this.active = false;
    
    console.log(`ğŸ—‘ï¸ ${this.name} åŸç”Ÿæ²™ç®±å·²é”€æ¯`);
  }

  /**
   * è·å–æ²™ç®±çŠ¶æ€
   */
  getStatus() {
    return {
      name: this.name,
      active: this.active,
      created: !!this.sandboxWindow,
      messageHandlers: Array.from(this.messageHandlers.keys())
    };
  }
}
```

## CSS æ ·å¼éš”ç¦»

### 1. å‘½åç©ºé—´éš”ç¦»

é€šè¿‡ä¸ºæ¯ä¸ªåº”ç”¨æ·»åŠ å”¯ä¸€çš„ CSS å‘½åç©ºé—´æ¥å®ç°æ ·å¼éš”ç¦»ã€‚

```javascript
/**
 * CSS å‘½åç©ºé—´éš”ç¦»å™¨
 */
class CSSNamespaceIsolation {
  constructor(appName) {
    this.appName = appName;
    this.namespace = `micro-app-${appName}`;
    this.dynamicStyles = [];
    this.originalStyles = [];
    this.isActive = false;
    this.observer = null;
  }

  /**
   * æ¿€æ´»æ ·å¼éš”ç¦»
   */
  activate(container) {
    if (this.isActive) return;

    console.log(`ğŸ¨ æ¿€æ´» ${this.appName} CSS éš”ç¦»`);

    // ä¸ºå®¹å™¨æ·»åŠ å‘½åç©ºé—´
    container.classList.add(this.namespace);
    
    // è®°å½•ç°æœ‰æ ·å¼
    this.recordExistingStyles();
    
    // å¼€å§‹ç›‘å¬æ ·å¼å˜åŒ–
    this.startStyleMonitoring();
    
    this.isActive = true;
  }

  /**
   * å¤±æ´»æ ·å¼éš”ç¦»
   */
  deactivate(container) {
    if (!this.isActive) return;

    console.log(`ğŸ¨ å¤±æ´» ${this.appName} CSS éš”ç¦»`);

    // ç§»é™¤åŠ¨æ€æ ·å¼
    this.removeDynamicStyles();
    
    // ç§»é™¤å‘½åç©ºé—´
    container.classList.remove(this.namespace);
    
    // åœæ­¢ç›‘å¬
    this.stopStyleMonitoring();
    
    this.isActive = false;
  }

  /**
   * è®°å½•ç°æœ‰æ ·å¼èŠ‚ç‚¹
   */
  recordExistingStyles() {
    this.originalStyles = Array.from(
      document.head.querySelectorAll('style, link[rel="stylesheet"]')
    );
    console.log(`ğŸ“ è®°å½•äº† ${this.originalStyles.length} ä¸ªç°æœ‰æ ·å¼`);
  }

  /**
   * å¼€å§‹ç›‘å¬æ ·å¼å˜åŒ–
   */
  startStyleMonitoring() {
    this.observer = new MutationObserver(mutations => {
      mutations.forEach(mutation => {
        mutation.addedNodes.forEach(node => {
          if (this.isStyleNode(node) && !this.isOriginalStyle(node)) {
            this.handleNewStyleNode(node);
          }
        });
      });
    });

    this.observer.observe(document.head, {
      childList: true,
      subtree: true
    });
  }

  /**
   * åœæ­¢ç›‘å¬æ ·å¼å˜åŒ–
   */
  stopStyleMonitoring() {
    if (this.observer) {
      this.observer.disconnect();
      this.observer = null;
    }
  }

  /**
   * åˆ¤æ–­æ˜¯å¦ä¸ºæ ·å¼èŠ‚ç‚¹
   */
  isStyleNode(node) {
    return node.nodeType === Node.ELEMENT_NODE && 
           (node.tagName === 'STYLE' || 
            (node.tagName === 'LINK' && node.rel === 'stylesheet'));
  }

  /**
   * åˆ¤æ–­æ˜¯å¦ä¸ºåŸå§‹æ ·å¼
   */
  isOriginalStyle(node) {
    return this.originalStyles.includes(node);
  }

  /**
   * å¤„ç†æ–°å¢çš„æ ·å¼èŠ‚ç‚¹
   */
  handleNewStyleNode(node) {
    // æ ‡è®°æ ·å¼å±äºå½“å‰åº”ç”¨
    node.setAttribute('data-micro-app', this.appName);
    this.dynamicStyles.push(node);

    if (node.tagName === 'STYLE') {
      this.processStyleContent(node);
    } else if (node.tagName === 'LINK') {
      this.processLinkStylesheet(node);
    }
  }

  /**
   * å¤„ç† style æ ‡ç­¾å†…å®¹
   */
  processStyleContent(styleNode) {
    try {
      const originalCSS = styleNode.textContent || styleNode.innerHTML;
      if (!originalCSS.trim()) return;

      const namespacedCSS = this.addNamespaceToCSS(originalCSS);
      styleNode.textContent = namespacedCSS;
      
      console.log(`âœ… å·²ä¸ºæ ·å¼æ·»åŠ å‘½åç©ºé—´`);
    } catch (error) {
      console.warn(`âš ï¸ å¤„ç†æ ·å¼å†…å®¹å¤±è´¥:`, error);
    }
  }

  /**
   * å¤„ç† link æ ·å¼è¡¨
   */
  async processLinkStylesheet(linkNode) {
    if (!linkNode.href || linkNode.href.startsWith('data:')) return;

    try {
      const response = await fetch(linkNode.href);
      const cssText = await response.text();
      
      // åˆ›å»ºæ–°çš„ style æ ‡ç­¾æ›¿ä»£
      const styleNode = document.createElement('style');
      styleNode.setAttribute('data-micro-app', this.appName);
      styleNode.setAttribute('data-original-href', linkNode.href);
      styleNode.textContent = this.addNamespaceToCSS(cssText);
      
      // æ›¿æ¢åŸæ¥çš„ link æ ‡ç­¾
      linkNode.parentNode.insertBefore(styleNode, linkNode);
      linkNode.parentNode.removeChild(linkNode);
      
      // æ›´æ–°åŠ¨æ€æ ·å¼åˆ—è¡¨
      const linkIndex = this.dynamicStyles.indexOf(linkNode);
      if (linkIndex > -1) {
        this.dynamicStyles[linkIndex] = styleNode;
      }
      
      console.log(`âœ… å·²å¤„ç†å¤–éƒ¨æ ·å¼è¡¨: ${linkNode.href}`);
    } catch (error) {
      console.warn(`âš ï¸ å¤„ç†å¤–éƒ¨æ ·å¼è¡¨å¤±è´¥:`, error);
    }
  }

  /**
   * ä¸º CSS æ·»åŠ å‘½åç©ºé—´
   */
  addNamespaceToCSS(cssText) {
    // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¤„ç†é€‰æ‹©å™¨
    return cssText.replace(/([^{}]+)\s*\{/g, (match, selectors) => {
      // è·³è¿‡ @è§„åˆ™ï¼ˆå¦‚ @media, @keyframes ç­‰ï¼‰
      if (selectors.trim().startsWith('@')) {
        return match;
      }

      // å¤„ç†å¤šä¸ªé€‰æ‹©å™¨ï¼ˆé€—å·åˆ†éš”ï¼‰
      const processedSelectors = selectors
        .split(',')
        .map(selector => this.addNamespaceToSelector(selector.trim()))
        .join(', ');

      return `${processedSelectors} {`;
    });
  }

  /**
   * ä¸ºå•ä¸ªé€‰æ‹©å™¨æ·»åŠ å‘½åç©ºé—´
   */
  addNamespaceToSelector(selector) {
    // å¤„ç†ç‰¹æ®Šé€‰æ‹©å™¨
    if (selector === 'html' || selector === 'body') {
      return `.${this.namespace}`;
    }

    if (selector.startsWith('html ') || selector.startsWith('body ')) {
      return selector.replace(/^(html|body)\s*/, `.${this.namespace} `);
    }

    // å¦‚æœå·²åŒ…å«å‘½åç©ºé—´ï¼Œè·³è¿‡
    if (selector.includes(`.${this.namespace}`)) {
      return selector;
    }

    // å¤„ç†ä¼ªç±»å’Œä¼ªå…ƒç´ 
    const pseudoRegex = /^([^:]+)(:.*)$/;
    const pseudoMatch = selector.match(pseudoRegex);
    
    if (pseudoMatch) {
      const [, baseSelector, pseudo] = pseudoMatch;
      return `.${this.namespace} ${baseSelector}${pseudo}`;
    }

    // æ™®é€šé€‰æ‹©å™¨
    return `.${this.namespace} ${selector}`;
  }

  /**
   * ç§»é™¤åŠ¨æ€æ ·å¼
   */
  removeDynamicStyles() {
    console.log(`ğŸ—‘ï¸ æ¸…ç† ${this.appName} çš„ ${this.dynamicStyles.length} ä¸ªæ ·å¼`);
    
    this.dynamicStyles.forEach(styleNode => {
      if (styleNode && styleNode.parentNode) {
        styleNode.parentNode.removeChild(styleNode);
      }
    });
    
    this.dynamicStyles = [];
  }

  /**
   * è·å–æ ·å¼ç»Ÿè®¡
   */
  getStats() {
    return {
      appName: this.appName,
      namespace: this.namespace,
      isActive: this.isActive,
      dynamicStyles: this.dynamicStyles.length,
      originalStyles: this.originalStyles.length
    };
  }
}
```

### 2. Shadow DOM éš”ç¦»

ä½¿ç”¨ Shadow DOM å®ç°çœŸæ­£çš„æ ·å¼éš”ç¦»ã€‚

```javascript
/**
 * Shadow DOM æ ·å¼éš”ç¦»å™¨
 */
class ShadowDOMIsolation {
  constructor(appName) {
    this.appName = appName;
    this.shadowHost = null;
    this.shadowRoot = null;
    this.isActive = false;
  }

  /**
   * åˆ›å»º Shadow DOM
   */
  create(container) {
    if (this.shadowRoot) {
      console.warn(`${this.appName} Shadow DOM å·²å­˜åœ¨`);
      return this.shadowRoot;
    }

    try {
      // åˆ›å»º shadow host
      this.shadowHost = document.createElement('div');
      this.shadowHost.setAttribute('data-micro-app', this.appName);
      
      // åˆ›å»º shadow root
      this.shadowRoot = this.shadowHost.attachShadow({ mode: 'open' });
      
      // åˆ›å»ºåº”ç”¨å®¹å™¨
      const appContainer = document.createElement('div');
      appContainer.id = 'app-root';
      appContainer.style.cssText = `
        width: 100%;
        height: 100%;
        position: relative;
      `;
      
      this.shadowRoot.appendChild(appContainer);
      container.appendChild(this.shadowHost);
      
      console.log(`ğŸŒŸ ${this.appName} Shadow DOM åˆ›å»ºæˆåŠŸ`);
      return this.shadowRoot;
    } catch (error) {
      console.error(`âŒ ${this.appName} Shadow DOM åˆ›å»ºå¤±è´¥:`, error);
      throw error;
    }
  }

  /**
   * æ¿€æ´» Shadow DOM éš”ç¦»
   */
  activate() {
    if (this.isActive || !this.shadowRoot) return;
    
    this.isActive = true;
    console.log(`ğŸŸ¢ ${this.appName} Shadow DOM éš”ç¦»å·²æ¿€æ´»`);
  }

  /**
   * å¤±æ´» Shadow DOM éš”ç¦»
   */
  deactivate() {
    if (!this.isActive) return;
    
    this.isActive = false;
    console.log(`ğŸ”´ ${this.appName} Shadow DOM éš”ç¦»å·²å¤±æ´»`);
  }

  /**
   * æ·»åŠ æ ·å¼åˆ° Shadow DOM
   */
  addStyle(cssText) {
    if (!this.shadowRoot) return;

    const style = document.createElement('style');
    style.textContent = cssText;
    this.shadowRoot.appendChild(style);
    
    console.log(`ğŸ“ å·²æ·»åŠ æ ·å¼åˆ° ${this.appName} Shadow DOM`);
  }

  /**
   * æ·»åŠ å¤–éƒ¨æ ·å¼è¡¨åˆ° Shadow DOM
   */
  addStylesheet(href) {
    if (!this.shadowRoot) return;

    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = href;
    this.shadowRoot.appendChild(link);
    
    console.log(`ğŸ”— å·²æ·»åŠ æ ·å¼è¡¨åˆ° ${this.appName} Shadow DOM: ${href}`);
  }

  /**
   * è·å–åº”ç”¨å®¹å™¨
   */
  getContainer() {
    return this.shadowRoot ? this.shadowRoot.querySelector('#app-root') : null;
  }

  /**
   * é”€æ¯ Shadow DOM
   */
  destroy() {
    if (this.shadowHost && this.shadowHost.parentNode) {
      this.shadowHost.parentNode.removeChild(this.shadowHost);
    }
    
    this.shadowHost = null;
    this.shadowRoot = null;
    this.isActive = false;
    
    console.log(`ğŸ—‘ï¸ ${this.appName} Shadow DOM å·²é”€æ¯`);
  }

  /**
   * è·å–çŠ¶æ€
   */
  getStatus() {
    return {
      appName: this.appName,
      isActive: this.isActive,
      created: !!this.shadowRoot,
      host: this.shadowHost,
      root: this.shadowRoot
    };
  }
}
```

## èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†

### åº”ç”¨æ¸…ç†å™¨

ç¡®ä¿åº”ç”¨å¸è½½æ—¶èƒ½å¤Ÿå®Œå…¨æ¸…ç†æ‰€æœ‰èµ„æºã€‚

```javascript
/**
 * åº”ç”¨èµ„æºæ¸…ç†å™¨
 * æ ¸å¿ƒæ€è·¯ï¼šè®°å½•æ‰€æœ‰å‰¯ä½œç”¨ï¼Œå¸è½½æ—¶ç»Ÿä¸€æ¸…ç†
 */
class ApplicationCleaner {
  constructor(appName) {
    this.appName = appName;
    this.resources = {
      eventListeners: [],
      timers: [],
      intervals: [],
      observers: [],
      requestCallbacks: [],
      styleSheets: [],
      scripts: [],
      customElements: []
    };
    this.originalMethods = {};
    this.active = false;
  }

  /**
   * æ¿€æ´»èµ„æºè¿½è¸ª
   */
  activate() {
    if (this.active) return;

    this.hookGlobalMethods();
    this.active = true;
    
    console.log(`ğŸ” ${this.appName} èµ„æºè¿½è¸ªå·²æ¿€æ´»`);
  }

  /**
   * é’©å­å…¨å±€æ–¹æ³•
   */
  hookGlobalMethods() {
    // é’©å­ addEventListener
    this.hookAddEventListener();
    
    // é’©å­å®šæ—¶å™¨
    this.hookTimers();
    
    // é’©å­è§‚å¯Ÿè€…
    this.hookObservers();
    
    // é’©å­è¯·æ±‚æ–¹æ³•
    this.hookRequestMethods();
  }

  /**
   * é’©å­äº‹ä»¶ç›‘å¬å™¨
   */
  hookAddEventListener() {
    const { resources } = this;
    
    // ä¿å­˜åŸå§‹æ–¹æ³•
    this.originalMethods.addEventListener = EventTarget.prototype.addEventListener;
    this.originalMethods.removeEventListener = EventTarget.prototype.removeEventListener;
    
    // é‡å†™ addEventListener
    EventTarget.prototype.addEventListener = function(type, listener, options) {
      // è®°å½•äº‹ä»¶ç›‘å¬å™¨
      resources.eventListeners.push({
        target: this,
        type,
        listener,
        options
      });
      
      return this.originalMethods.addEventListener.call(this, type, listener, options);
    }.bind(this);
  }

  /**
   * é’©å­å®šæ—¶å™¨
   */
  hookTimers() {
    const { resources } = this;
    
    // ä¿å­˜åŸå§‹æ–¹æ³•
    this.originalMethods.setTimeout = window.setTimeout;
    this.originalMethods.clearTimeout = window.clearTimeout;
    this.originalMethods.setInterval = window.setInterval;
    this.originalMethods.clearInterval = window.clearInterval;
    
    // é‡å†™ setTimeout
    window.setTimeout = (callback, delay, ...args) => {
      const id = this.originalMethods.setTimeout(callback, delay, ...args);
      resources.timers.push(id);
      return id;
    };
    
    // é‡å†™ setInterval
    window.setInterval = (callback, delay, ...args) => {
      const id = this.originalMethods.setInterval(callback, delay, ...args);
      resources.intervals.push(id);
      return id;
    };
  }

  /**
   * é’©å­è§‚å¯Ÿè€…
   */
  hookObservers() {
    const { resources } = this;
    
    // MutationObserver
    const OriginalMutationObserver = window.MutationObserver;
    window.MutationObserver = function(...args) {
      const observer = new OriginalMutationObserver(...args);
      resources.observers.push(observer);
      return observer;
    };
    
    // IntersectionObserver
    const OriginalIntersectionObserver = window.IntersectionObserver;
    window.IntersectionObserver = function(...args) {
      const observer = new OriginalIntersectionObserver(...args);
      resources.observers.push(observer);
      return observer;
    };
    
    // ResizeObserver
    if (window.ResizeObserver) {
      const OriginalResizeObserver = window.ResizeObserver;
      window.ResizeObserver = function(...args) {
        const observer = new OriginalResizeObserver(...args);
        resources.observers.push(observer);
        return observer;
      };
    }
  }

  /**
   * é’©å­è¯·æ±‚æ–¹æ³•
   */
  hookRequestMethods() {
    const { resources } = this;
    
    // requestAnimationFrame
    this.originalMethods.requestAnimationFrame = window.requestAnimationFrame;
    this.originalMethods.cancelAnimationFrame = window.cancelAnimationFrame;
    
    window.requestAnimationFrame = (callback) => {
      const id = this.originalMethods.requestAnimationFrame(callback);
      resources.requestCallbacks.push(id);
      return id;
    };
    
    // requestIdleCallback
    if (window.requestIdleCallback) {
      this.originalMethods.requestIdleCallback = window.requestIdleCallback;
      this.originalMethods.cancelIdleCallback = window.cancelIdleCallback;
      
      window.requestIdleCallback = (callback, options) => {
        const id = this.originalMethods.requestIdleCallback(callback, options);
        resources.requestCallbacks.push(id);
        return id;
      };
    }
  }

  /**
   * æ·»åŠ æ ·å¼è¡¨
   */
  addStyleSheet(element) {
    this.resources.styleSheets.push(element);
  }

  /**
   * æ·»åŠ è„šæœ¬
   */
  addScript(element) {
    this.resources.scripts.push(element);
  }

  /**
   * å¤±æ´»å¹¶æ¸…ç†æ‰€æœ‰èµ„æº
   */
  deactivate() {
    if (!this.active) return;

    console.log(`ğŸ§¹ å¼€å§‹æ¸…ç† ${this.appName} çš„èµ„æº`);
    
    this.cleanupResources();
    this.restoreGlobalMethods();
    
    this.active = false;
    console.log(`âœ… ${this.appName} èµ„æºæ¸…ç†å®Œæˆ`);
  }

  /**
   * æ¸…ç†èµ„æº
   */
  cleanupResources() {
    const { resources } = this;
    
    // æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
    resources.eventListeners.forEach(({ target, type, listener, options }) => {
      try {
        target.removeEventListener(type, listener, options);
      } catch (error) {
        console.warn('æ¸…ç†äº‹ä»¶ç›‘å¬å™¨å¤±è´¥:', error);
      }
    });
    
    // æ¸…ç†å®šæ—¶å™¨
    resources.timers.forEach(id => {
      this.originalMethods.clearTimeout(id);
    });
    
    resources.intervals.forEach(id => {
      this.originalMethods.clearInterval(id);
    });
    
    // æ¸…ç†è§‚å¯Ÿè€…
    resources.observers.forEach(observer => {
      try {
        observer.disconnect();
      } catch (error) {
        console.warn('æ¸…ç†è§‚å¯Ÿè€…å¤±è´¥:', error);
      }
    });
    
    // æ¸…ç†è¯·æ±‚å›è°ƒ
    resources.requestCallbacks.forEach(id => {
      this.originalMethods.cancelAnimationFrame(id);
      if (this.originalMethods.cancelIdleCallback) {
        this.originalMethods.cancelIdleCallback(id);
      }
    });
    
    // æ¸…ç†æ ·å¼è¡¨
    resources.styleSheets.forEach(element => {
      if (element && element.parentNode) {
        element.parentNode.removeChild(element);
      }
    });
    
    // æ¸…ç†è„šæœ¬
    resources.scripts.forEach(element => {
      if (element && element.parentNode) {
        element.parentNode.removeChild(element);
      }
    });
    
    // é‡ç½®èµ„æºè®°å½•
    Object.keys(resources).forEach(key => {
      resources[key] = [];
    });
  }

  /**
   * æ¢å¤å…¨å±€æ–¹æ³•
   */
  restoreGlobalMethods() {
    // æ¢å¤äº‹ä»¶æ–¹æ³•
    if (this.originalMethods.addEventListener) {
      EventTarget.prototype.addEventListener = this.originalMethods.addEventListener;
      EventTarget.prototype.removeEventListener = this.originalMethods.removeEventListener;
    }
    
    // æ¢å¤å®šæ—¶å™¨æ–¹æ³•
    if (this.originalMethods.setTimeout) {
      window.setTimeout = this.originalMethods.setTimeout;
      window.clearTimeout = this.originalMethods.clearTimeout;
      window.setInterval = this.originalMethods.setInterval;
      window.clearInterval = this.originalMethods.clearInterval;
    }
    
    // æ¢å¤è¯·æ±‚æ–¹æ³•
    if (this.originalMethods.requestAnimationFrame) {
      window.requestAnimationFrame = this.originalMethods.requestAnimationFrame;
      window.cancelAnimationFrame = this.originalMethods.cancelAnimationFrame;
    }
    
    if (this.originalMethods.requestIdleCallback) {
      window.requestIdleCallback = this.originalMethods.requestIdleCallback;
      window.cancelIdleCallback = this.originalMethods.cancelIdleCallback;
    }
  }

  /**
   * è·å–èµ„æºç»Ÿè®¡
   */
  getResourceStats() {
    const { resources } = this;
    
    return {
      appName: this.appName,
      active: this.active,
      eventListeners: resources.eventListeners.length,
      timers: resources.timers.length,
      intervals: resources.intervals.length,
      observers: resources.observers.length,
      requestCallbacks: resources.requestCallbacks.length,
      styleSheets: resources.styleSheets.length,
      scripts: resources.scripts.length,
      total: Object.values(resources).reduce((sum, arr) => sum + arr.length, 0)
    };
  }
}
```

## äº‹ä»¶å’Œå†…å­˜ç®¡ç†

### å†…å­˜æ³„æ¼æ£€æµ‹å™¨

```javascript
/**
 * å†…å­˜æ³„æ¼æ£€æµ‹å™¨
 */
class MemoryLeakDetector {
  constructor(appName) {
    this.appName = appName;
    this.memorySnapshots = [];
    this.leakThreshold = 50 * 1024 * 1024; // 50MB
    this.checkInterval = 30000; // 30ç§’æ£€æŸ¥ä¸€æ¬¡
    this.checking = false;
    this.detectedLeaks = [];
  }

  /**
   * å¼€å§‹å†…å­˜ç›‘æ§
   */
  startMonitoring() {
    if (this.checking) return;
    
    this.checking = true;
    this.takeSnapshot('initial');
    
    this.checkTimer = setInterval(() => {
      this.checkMemoryUsage();
    }, this.checkInterval);
    
    console.log(`ğŸ” ${this.appName} å†…å­˜ç›‘æ§å·²å¯åŠ¨`);
  }

  /**
   * åœæ­¢å†…å­˜ç›‘æ§
   */
  stopMonitoring() {
    if (!this.checking) return;
    
    this.checking = false;
    
    if (this.checkTimer) {
      clearInterval(this.checkTimer);
      this.checkTimer = null;
    }
    
    this.takeSnapshot('final');
    this.generateReport();
    
    console.log(`ğŸ” ${this.appName} å†…å­˜ç›‘æ§å·²åœæ­¢`);
  }

  /**
   * è·å–å†…å­˜ä¿¡æ¯
   */
  getMemoryInfo() {
    if (performance.memory) {
      return {
        usedJSHeapSize: performance.memory.usedJSHeapSize,
        totalJSHeapSize: performance.memory.totalJSHeapSize,
        jsHeapSizeLimit: performance.memory.jsHeapSizeLimit,
        timestamp: Date.now()
      };
    }
    
    return {
      usedJSHeapSize: 0,
      totalJSHeapSize: 0,
      jsHeapSizeLimit: 0,
      timestamp: Date.now()
    };
  }

  /**
   * è®°å½•å†…å­˜å¿«ç…§
   */
  takeSnapshot(label) {
    const memoryInfo = this.getMemoryInfo();
    
    this.memorySnapshots.push({
      label,
      ...memoryInfo
    });
    
    console.log(`ğŸ“¸ ${this.appName} å†…å­˜å¿«ç…§ [${label}]:`, 
               `${(memoryInfo.usedJSHeapSize / 1024 / 1024).toFixed(2)}MB`);
  }

  /**
   * æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
   */
  checkMemoryUsage() {
    const currentMemory = this.getMemoryInfo();
    const lastSnapshot = this.memorySnapshots[this.memorySnapshots.length - 1];
    
    if (lastSnapshot) {
      const memoryIncrease = currentMemory.usedJSHeapSize - lastSnapshot.usedJSHeapSize;
      
      // æ£€æµ‹å†…å­˜å¢é•¿
      if (memoryIncrease > this.leakThreshold) {
        this.detectLeak(memoryIncrease, currentMemory);
      }
    }
    
    this.takeSnapshot('check');
    
    // ä¿æŒå¿«ç…§æ•°é‡åœ¨åˆç†èŒƒå›´å†…
    if (this.memorySnapshots.length > 50) {
      this.memorySnapshots.shift();
    }
  }

  /**
   * æ£€æµ‹å†…å­˜æ³„æ¼
   */
  detectLeak(increase, currentMemory) {
    const leak = {
      appName: this.appName,
      timestamp: Date.now(),
      memoryIncrease: increase,
      currentUsage: currentMemory.usedJSHeapSize,
      severity: this.calculateSeverity(increase)
    };
    
    this.detectedLeaks.push(leak);
    
    console.warn(`ğŸš¨ ${this.appName} æ£€æµ‹åˆ°å†…å­˜æ³„æ¼:`, 
                `å¢é•¿ ${(increase / 1024 / 1024).toFixed(2)}MB`,
                `å½“å‰ä½¿ç”¨ ${(currentMemory.usedJSHeapSize / 1024 / 1024).toFixed(2)}MB`);
    
    // è§¦å‘åƒåœ¾å›æ”¶ï¼ˆå¦‚æœå¯ç”¨ï¼‰
    if (window.gc) {
      window.gc();
    }
  }

  /**
   * è®¡ç®—æ³„æ¼ä¸¥é‡ç¨‹åº¦
   */
  calculateSeverity(increase) {
    if (increase > 100 * 1024 * 1024) return 'critical';
    if (increase > 50 * 1024 * 1024) return 'high';
    if (increase > 20 * 1024 * 1024) return 'medium';
    return 'low';
  }

  /**
   * ç”Ÿæˆå†…å­˜æŠ¥å‘Š
   */
  generateReport() {
    const report = {
      appName: this.appName,
      snapshots: this.memorySnapshots,
      leaks: this.detectedLeaks,
      summary: this.generateSummary()
    };
    
    console.log(`ğŸ“Š ${this.appName} å†…å­˜ä½¿ç”¨æŠ¥å‘Š:`, report);
    return report;
  }

  /**
   * ç”Ÿæˆæ‘˜è¦
   */
  generateSummary() {
    if (this.memorySnapshots.length < 2) {
      return { status: 'insufficient_data' };
    }
    
    const initial = this.memorySnapshots[0];
    const final = this.memorySnapshots[this.memorySnapshots.length - 1];
    const totalIncrease = final.usedJSHeapSize - initial.usedJSHeapSize;
    
    return {
      initialMemory: initial.usedJSHeapSize,
      finalMemory: final.usedJSHeapSize,
      totalIncrease,
      leakCount: this.detectedLeaks.length,
      status: this.detectedLeaks.length > 0 ? 'leaks_detected' : 'clean'
    };
  }
}
```

## å®Œæ•´æ²™ç®±å®ç°

### ç»Ÿä¸€æ²™ç®±ç®¡ç†å™¨

```javascript
/**
 * å®Œæ•´çš„å¾®å‰ç«¯æ²™ç®±ç®¡ç†å™¨
 * é›†æˆæ‰€æœ‰éš”ç¦»åŠŸèƒ½
 */
class MicroFrontendSandbox {
  constructor(appName, options = {}) {
    this.appName = appName;
    this.options = {
      enableJSIsolation: true,
      enableCSSIsolation: true,
      enableResourceTracking: true,
      enableMemoryMonitoring: false,
      sandboxType: 'proxy', // 'snapshot' | 'proxy' | 'native' | 'shadow'
      ...options
    };
    
    this.container = null;
    this.jsSandbox = null;
    this.cssIsolation = null;
    this.resourceCleaner = null;
    this.memoryDetector = null;
    this.isActive = false;
    
    this.initializeSandbox();
  }

  /**
   * åˆå§‹åŒ–æ²™ç®±
   */
  initializeSandbox() {
    const { options, appName } = this;
    
    // åˆå§‹åŒ– JavaScript æ²™ç®±
    if (options.enableJSIsolation) {
      switch (options.sandboxType) {
        case 'snapshot':
          this.jsSandbox = new SnapshotSandbox(appName);
          break;
        case 'proxy':
          this.jsSandbox = new ProxySandbox(appName);
          break;
        case 'native':
          this.jsSandbox = new NativeSandbox(appName);
          break;
        default:
          this.jsSandbox = new ProxySandbox(appName);
      }
    }
    
    // åˆå§‹åŒ– CSS éš”ç¦»
    if (options.enableCSSIsolation) {
      if (options.sandboxType === 'shadow') {
        this.cssIsolation = new ShadowDOMIsolation(appName);
      } else {
        this.cssIsolation = new CSSNamespaceIsolation(appName);
      }
    }
    
    // åˆå§‹åŒ–èµ„æºæ¸…ç†å™¨
    if (options.enableResourceTracking) {
      this.resourceCleaner = new ApplicationCleaner(appName);
    }
    
    // åˆå§‹åŒ–å†…å­˜ç›‘æ§
    if (options.enableMemoryMonitoring) {
      this.memoryDetector = new MemoryLeakDetector(appName);
    }
    
    console.log(`ğŸ—ï¸ ${appName} æ²™ç®±åˆå§‹åŒ–å®Œæˆ`, this.options);
  }

  /**
   * è®¾ç½®å®¹å™¨
   */
  setContainer(container) {
    this.container = container;
    
    // ä¸º Shadow DOM åˆ›å»ºéš”ç¦»ç¯å¢ƒ
    if (this.options.sandboxType === 'shadow' && this.cssIsolation) {
      const shadowRoot = this.cssIsolation.create(container);
      this.container = this.cssIsolation.getContainer();
    }
  }

  /**
   * æ¿€æ´»æ²™ç®±
   */
  async activate() {
    if (this.isActive) return;
    
    console.log(`ğŸŸ¢ æ¿€æ´» ${this.appName} æ²™ç®±`);
    
    try {
      // æ¿€æ´» JavaScript æ²™ç®±
      if (this.jsSandbox) {
        if (this.jsSandbox.create) {
          await this.jsSandbox.create();
        }
        this.jsSandbox.activate();
      }
      
      // æ¿€æ´» CSS éš”ç¦»
      if (this.cssIsolation && this.container) {
        this.cssIsolation.activate(this.container);
      }
      
      // æ¿€æ´»èµ„æºè¿½è¸ª
      if (this.resourceCleaner) {
        this.resourceCleaner.activate();
      }
      
      // å¼€å§‹å†…å­˜ç›‘æ§
      if (this.memoryDetector) {
        this.memoryDetector.startMonitoring();
      }
      
      this.isActive = true;
      console.log(`âœ… ${this.appName} æ²™ç®±æ¿€æ´»å®Œæˆ`);
      
    } catch (error) {
      console.error(`âŒ ${this.appName} æ²™ç®±æ¿€æ´»å¤±è´¥:`, error);
      throw error;
    }
  }

  /**
   * å¤±æ´»æ²™ç®±
   */
  async deactivate() {
    if (!this.isActive) return;
    
    console.log(`ğŸ”´ å¤±æ´» ${this.appName} æ²™ç®±`);
    
    try {
      // åœæ­¢å†…å­˜ç›‘æ§
      if (this.memoryDetector) {
        this.memoryDetector.stopMonitoring();
      }
      
      // æ¸…ç†èµ„æº
      if (this.resourceCleaner) {
        this.resourceCleaner.deactivate();
      }
      
      // å¤±æ´» CSS éš”ç¦»
      if (this.cssIsolation) {
        if (this.cssIsolation.deactivate) {
          this.cssIsolation.deactivate(this.container);
        }
      }
      
      // å¤±æ´» JavaScript æ²™ç®±
      if (this.jsSandbox) {
        this.jsSandbox.deactivate();
      }
      
      this.isActive = false;
      console.log(`âœ… ${this.appName} æ²™ç®±å¤±æ´»å®Œæˆ`);
      
    } catch (error) {
      console.error(`âŒ ${this.appName} æ²™ç®±å¤±æ´»å¤±è´¥:`, error);
      throw error;
    }
  }

  /**
   * é”€æ¯æ²™ç®±
   */
  async destroy() {
    await this.deactivate();
    
    // é”€æ¯æ‰€æœ‰ç»„ä»¶
    if (this.jsSandbox && this.jsSandbox.destroy) {
      this.jsSandbox.destroy();
    }
    
    if (this.cssIsolation && this.cssIsolation.destroy) {
      this.cssIsolation.destroy();
    }
    
    this.jsSandbox = null;
    this.cssIsolation = null;
    this.resourceCleaner = null;
    this.memoryDetector = null;
    this.container = null;
    
    console.log(`ğŸ—‘ï¸ ${this.appName} æ²™ç®±å·²é”€æ¯`);
  }

  /**
   * è·å–ä»£ç† windowï¼ˆå¦‚æœæ”¯æŒï¼‰
   */
  getProxyWindow() {
    if (this.jsSandbox && this.jsSandbox.getProxyWindow) {
      return this.jsSandbox.getProxyWindow();
    }
    return window;
  }

  /**
   * è·å–åº”ç”¨å®¹å™¨
   */
  getContainer() {
    return this.container;
  }

  /**
   * æ·»åŠ æ ·å¼
   */
  addStyle(cssText) {
    if (this.cssIsolation && this.cssIsolation.addStyle) {
      this.cssIsolation.addStyle(cssText);
    }
  }

  /**
   * æ·»åŠ æ ·å¼è¡¨
   */
  addStylesheet(href) {
    if (this.cssIsolation && this.cssIsolation.addStylesheet) {
      this.cssIsolation.addStylesheet(href);
    }
  }

  /**
   * è·å–æ²™ç®±çŠ¶æ€
   */
  getStatus() {
    return {
      appName: this.appName,
      isActive: this.isActive,
      options: this.options,
      jsSandbox: this.jsSandbox ? this.jsSandbox.getStatus() : null,
      cssIsolation: this.cssIsolation ? this.cssIsolation.getStats() : null,
      resourceCleaner: this.resourceCleaner ? this.resourceCleaner.getResourceStats() : null,
      memoryDetector: this.memoryDetector ? this.memoryDetector.generateReport() : null
    };
  }

  /**
   * è¿è¡Œä»£ç åœ¨æ²™ç®±ä¸­
   */
  execute(code) {
    if (this.jsSandbox && this.jsSandbox.execute) {
      return this.jsSandbox.execute(code);
    }
    
    // ä½¿ç”¨ä»£ç† window æ‰§è¡Œ
    const proxyWindow = this.getProxyWindow();
    return (function() {
      return eval(code);
    }).call(proxyWindow);
  }
}
```

## æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„æ²™ç®±ç­–ç•¥

```javascript
/**
 * æ²™ç®±ç­–ç•¥é€‰æ‹©å™¨
 */
class SandboxStrategySelector {
  static selectStrategy(requirements) {
    const {
      multiInstance = false,
      strictIsolation = false,
      performance = 'medium',
      compatibility = 'modern',
      features = []
    } = requirements;
    
    // ä¸¥æ ¼éš”ç¦»éœ€æ±‚
    if (strictIsolation) {
      if (features.includes('shadow-dom') && compatibility === 'modern') {
        return 'shadow';
      }
      return 'native';
    }
    
    // å¤šå®ä¾‹éœ€æ±‚
    if (multiInstance) {
      return 'proxy';
    }
    
    // æ€§èƒ½ä¼˜å…ˆ
    if (performance === 'high') {
      return 'snapshot';
    }
    
    // é»˜è®¤ç­–ç•¥
    return 'proxy';
  }
  
  static createSandbox(appName, requirements) {
    const strategy = this.selectStrategy(requirements);
    
    const options = {
      sandboxType: strategy,
      enableJSIsolation: true,
      enableCSSIsolation: !requirements.disableCSSIsolation,
      enableResourceTracking: true,
      enableMemoryMonitoring: requirements.enableMemoryMonitoring || false
    };
    
    return new MicroFrontendSandbox(appName, options);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const reactAppSandbox = SandboxStrategySelector.createSandbox('react-app', {
  multiInstance: true,
  performance: 'high',
  compatibility: 'modern',
  features: ['css-isolation', 'resource-tracking']
});

const vueAppSandbox = SandboxStrategySelector.createSandbox('vue-app', {
  strictIsolation: true,
  features: ['shadow-dom'],
  enableMemoryMonitoring: true
});
```

### 2. æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

```javascript
/**
 * æ²™ç®±æ€§èƒ½ç›‘æ§å™¨
 */
class SandboxPerformanceMonitor {
  constructor() {
    this.metrics = new Map();
    this.observers = [];
  }

  /**
   * ç›‘æ§æ²™ç®±æ€§èƒ½
   */
  monitor(sandbox) {
    const appName = sandbox.appName;
    
    if (this.metrics.has(appName)) {
      return; // å·²åœ¨ç›‘æ§ä¸­
    }
    
    const metrics = {
      activationTime: [],
      deactivationTime: [],
      memoryUsage: [],
      resourceCount: []
    };
    
    this.metrics.set(appName, metrics);
    
    // ç›‘æ§æ¿€æ´»æ—¶é—´
    const originalActivate = sandbox.activate.bind(sandbox);
    sandbox.activate = async () => {
      const start = performance.now();
      await originalActivate();
      const duration = performance.now() - start;
      
      metrics.activationTime.push(duration);
      console.log(`ğŸ“Š ${appName} æ¿€æ´»è€—æ—¶: ${duration.toFixed(2)}ms`);
    };
    
    // ç›‘æ§å¤±æ´»æ—¶é—´
    const originalDeactivate = sandbox.deactivate.bind(sandbox);
    sandbox.deactivate = async () => {
      const start = performance.now();
      await originalDeactivate();
      const duration = performance.now() - start;
      
      metrics.deactivationTime.push(duration);
      console.log(`ğŸ“Š ${appName} å¤±æ´»è€—æ—¶: ${duration.toFixed(2)}ms`);
    };
    
    // å®šæœŸæ”¶é›†èµ„æºä½¿ç”¨æƒ…å†µ
    const collectMetrics = () => {
      const status = sandbox.getStatus();
      
      if (status.resourceCleaner) {
        metrics.resourceCount.push(status.resourceCleaner.total);
      }
      
      if (performance.memory) {
        metrics.memoryUsage.push(performance.memory.usedJSHeapSize);
      }
    };
    
    const interval = setInterval(collectMetrics, 5000);
    this.observers.push(() => clearInterval(interval));
  }

  /**
   * è·å–æ€§èƒ½æŠ¥å‘Š
   */
  getReport(appName) {
    const metrics = this.metrics.get(appName);
    if (!metrics) return null;
    
    const calculateStats = (arr) => {
      if (arr.length === 0) return { avg: 0, min: 0, max: 0, count: 0 };
      
      const sum = arr.reduce((a, b) => a + b, 0);
      return {
        avg: sum / arr.length,
        min: Math.min(...arr),
        max: Math.max(...arr),
        count: arr.length
      };
    };
    
    return {
      appName,
      activationTime: calculateStats(metrics.activationTime),
      deactivationTime: calculateStats(metrics.deactivationTime),
      resourceCount: calculateStats(metrics.resourceCount),
      memoryUsage: calculateStats(metrics.memoryUsage),
      timestamp: Date.now()
    };
  }

  /**
   * è·å–æ‰€æœ‰åº”ç”¨çš„æŠ¥å‘Š
   */
  getAllReports() {
    const reports = {};
    
    this.metrics.forEach((_, appName) => {
      reports[appName] = this.getReport(appName);
    });
    
    return reports;
  }

  /**
   * æ¸…ç†ç›‘æ§
   */
  cleanup() {
    this.observers.forEach(cleanup => cleanup());
    this.observers = [];
    this.metrics.clear();
  }
}
```

### 3. è°ƒè¯•å’Œå¼€å‘å·¥å…·

```javascript
/**
 * æ²™ç®±è°ƒè¯•å·¥å…·
 */
class SandboxDebugger {
  constructor() {
    this.sandboxes = new Map();
    this.history = [];
    this.maxHistorySize = 1000;
    
    this.setupGlobalDebugger();
  }

  /**
   * æ³¨å†Œæ²™ç®±
   */
  register(sandbox) {
    this.sandboxes.set(sandbox.appName, sandbox);
    this.log('register', sandbox.appName);
  }

  /**
   * æ³¨é”€æ²™ç®±
   */
  unregister(appName) {
    this.sandboxes.delete(appName);
    this.log('unregister', appName);
  }

  /**
   * è®°å½•æ—¥å¿—
   */
  log(action, appName, data = {}) {
    const entry = {
      timestamp: Date.now(),
      action,
      appName,
      data
    };
    
    this.history.push(entry);
    
    if (this.history.length > this.maxHistorySize) {
      this.history.shift();
    }
    
    console.log(`ğŸ”§ [Sandbox Debug] ${action}: ${appName}`, data);
  }

  /**
   * è®¾ç½®å…¨å±€è°ƒè¯•å™¨
   */
  setupGlobalDebugger() {
    window.__SANDBOX_DEBUGGER__ = {
      // è·å–æ‰€æœ‰æ²™ç®±çŠ¶æ€
      getAllStatus: () => {
        const status = {};
        this.sandboxes.forEach((sandbox, name) => {
          status[name] = sandbox.getStatus();
        });
        return status;
      },
      
      // è·å–ç‰¹å®šæ²™ç®±çŠ¶æ€
      getStatus: (appName) => {
        const sandbox = this.sandboxes.get(appName);
        return sandbox ? sandbox.getStatus() : null;
      },
      
      // å¼ºåˆ¶æ¿€æ´»æ²™ç®±
      activate: (appName) => {
        const sandbox = this.sandboxes.get(appName);
        if (sandbox) {
          return sandbox.activate();
        }
        throw new Error(`æ²™ç®± ${appName} ä¸å­˜åœ¨`);
      },
      
      // å¼ºåˆ¶å¤±æ´»æ²™ç®±
      deactivate: (appName) => {
        const sandbox = this.sandboxes.get(appName);
        if (sandbox) {
          return sandbox.deactivate();
        }
        throw new Error(`æ²™ç®± ${appName} ä¸å­˜åœ¨`);
      },
      
      // è·å–è°ƒè¯•å†å²
      getHistory: (appName) => {
        if (appName) {
          return this.history.filter(entry => entry.appName === appName);
        }
        return this.history;
      },
      
      // æ¸…ç†è°ƒè¯•å†å²
      clearHistory: () => {
        this.history = [];
      },
      
      // å¯¼å‡ºæ²™ç®±çŠ¶æ€
      exportStatus: () => {
        return JSON.stringify(this.getAllStatus(), null, 2);
      },
      
      // æ£€æŸ¥å†…å­˜æ³„æ¼
      checkMemoryLeaks: () => {
        const reports = {};
        this.sandboxes.forEach((sandbox, name) => {
          if (sandbox.memoryDetector) {
            reports[name] = sandbox.memoryDetector.generateReport();
          }
        });
        return reports;
      }
    };
    
    console.log('ğŸ”§ æ²™ç®±è°ƒè¯•å™¨å·²å°±ç»ªï¼Œä½¿ç”¨ window.__SANDBOX_DEBUGGER__ è¿›è¡Œè°ƒè¯•');
  }
}
```

## æ€§èƒ½ä¼˜åŒ–

### å»¶è¿Ÿåˆå§‹åŒ–ç­–ç•¥

```javascript
/**
 * å»¶è¿Ÿåˆå§‹åŒ–çš„æ²™ç®±ç®¡ç†å™¨
 */
class LazyLoadingSandboxManager {
  constructor() {
    this.sandboxConfigs = new Map();
    this.sandboxInstances = new Map();
    this.initializationPromises = new Map();
  }

  /**
   * æ³¨å†Œæ²™ç®±é…ç½®ï¼ˆä¸ç«‹å³åˆ›å»ºï¼‰
   */
  register(appName, config) {
    this.sandboxConfigs.set(appName, config);
    console.log(`ğŸ“‹ æ³¨å†Œæ²™ç®±é…ç½®: ${appName}`);
  }

  /**
   * è·å–æ²™ç®±ï¼ˆå»¶è¿Ÿåˆ›å»ºï¼‰
   */
  async getSandbox(appName) {
    // å¦‚æœå·²å­˜åœ¨å®ä¾‹ï¼Œç›´æ¥è¿”å›
    if (this.sandboxInstances.has(appName)) {
      return this.sandboxInstances.get(appName);
    }

    // å¦‚æœæ­£åœ¨åˆå§‹åŒ–ï¼Œç­‰å¾…å®Œæˆ
    if (this.initializationPromises.has(appName)) {
      return this.initializationPromises.get(appName);
    }

    // å¼€å§‹åˆå§‹åŒ–
    const initPromise = this.initializeSandbox(appName);
    this.initializationPromises.set(appName, initPromise);

    try {
      const sandbox = await initPromise;
      this.sandboxInstances.set(appName, sandbox);
      this.initializationPromises.delete(appName);
      return sandbox;
    } catch (error) {
      this.initializationPromises.delete(appName);
      throw error;
    }
  }

  /**
   * åˆå§‹åŒ–æ²™ç®±
   */
  async initializeSandbox(appName) {
    const config = this.sandboxConfigs.get(appName);
    if (!config) {
      throw new Error(`æœªæ‰¾åˆ°åº”ç”¨ ${appName} çš„æ²™ç®±é…ç½®`);
    }

    console.log(`ğŸ—ï¸ å¼€å§‹åˆå§‹åŒ– ${appName} æ²™ç®±`);
    const startTime = performance.now();

    const sandbox = new MicroFrontendSandbox(appName, config);
    
    const duration = performance.now() - startTime;
    console.log(`âœ… ${appName} æ²™ç®±åˆå§‹åŒ–å®Œæˆï¼Œè€—æ—¶: ${duration.toFixed(2)}ms`);
    
    return sandbox;
  }

  /**
   * é¢„çƒ­æ²™ç®±
   */
  async preload(appName) {
    if (this.sandboxInstances.has(appName)) {
      return; // å·²é¢„çƒ­
    }

    console.log(`ğŸ”¥ é¢„çƒ­ ${appName} æ²™ç®±`);
    await this.getSandbox(appName);
  }

  /**
   * æ‰¹é‡é¢„çƒ­
   */
  async preloadAll(appNames) {
    const promises = appNames.map(appName => this.preload(appName));
    await Promise.all(promises);
    console.log(`ğŸ”¥ æ‰¹é‡é¢„çƒ­å®Œæˆ: ${appNames.join(', ')}`);
  }

  /**
   * æ¸…ç†æœªä½¿ç”¨çš„æ²™ç®±
   */
  cleanup(activeApps) {
    const activeSet = new Set(activeApps);
    
    this.sandboxInstances.forEach(async (sandbox, appName) => {
      if (!activeSet.has(appName)) {
        console.log(`ğŸ§¹ æ¸…ç†æœªä½¿ç”¨çš„æ²™ç®±: ${appName}`);
        await sandbox.destroy();
        this.sandboxInstances.delete(appName);
      }
    });
  }
}
```

## å¸¸è§é—®é¢˜

### 1. å…¼å®¹æ€§é—®é¢˜

```javascript
/**
 * å…¼å®¹æ€§æ£€æŸ¥å™¨
 */
class CompatibilityChecker {
  static check() {
    const results = {
      proxy: this.checkProxySupport(),
      shadowDOM: this.checkShadowDOMSupport(),
      mutationObserver: this.checkMutationObserverSupport(),
      performanceMemory: this.checkPerformanceMemorySupport(),
      weakMap: this.checkWeakMapSupport()
    };
    
    console.log('ğŸ” å…¼å®¹æ€§æ£€æŸ¥ç»“æœ:', results);
    return results;
  }
  
  static checkProxySupport() {
    try {
      new Proxy({}, {});
      return { supported: true, version: 'native' };
    } catch (e) {
      return { 
        supported: false, 
        fallback: 'snapshot',
        message: 'Proxy not supported, fallback to snapshot sandbox'
      };
    }
  }
  
  static checkShadowDOMSupport() {
    const support = document.createElement('div').attachShadow ? 'native' : 'none';
    return {
      supported: support === 'native',
      version: support,
      fallback: support === 'none' ? 'css-namespace' : null
    };
  }
  
  static checkMutationObserverSupport() {
    return {
      supported: typeof MutationObserver !== 'undefined',
      fallback: 'polling'
    };
  }
  
  static checkPerformanceMemorySupport() {
    return {
      supported: !!(performance && performance.memory),
      message: performance.memory ? null : 'Memory monitoring unavailable'
    };
  }
  
  static checkWeakMapSupport() {
    return {
      supported: typeof WeakMap !== 'undefined',
      fallback: 'Map'
    };
  }
  
  static getRecommendedStrategy() {
    const compatibility = this.check();
    
    if (!compatibility.proxy.supported) {
      return 'snapshot';
    }
    
    if (compatibility.shadowDOM.supported) {
      return 'shadow';
    }
    
    return 'proxy';
  }
}
```

### 2. é”™è¯¯å¤„ç†å’Œé™çº§ç­–ç•¥

```javascript
/**
 * æ²™ç®±é”™è¯¯å¤„ç†å™¨
 */
class SandboxErrorHandler {
  constructor() {
    this.errorStrategies = new Map();
    this.setupDefaultStrategies();
  }

  /**
   * è®¾ç½®é»˜è®¤é”™è¯¯å¤„ç†ç­–ç•¥
   */
  setupDefaultStrategies() {
    // Proxy åˆ›å»ºå¤±è´¥
    this.errorStrategies.set('proxy_creation_failed', {
      fallback: 'snapshot',
      action: (error, sandbox) => {
        console.warn('Proxy æ²™ç®±åˆ›å»ºå¤±è´¥ï¼Œé™çº§åˆ°å¿«ç…§æ²™ç®±', error);
        return new SnapshotSandbox(sandbox.appName);
      }
    });
    
    // Shadow DOM åˆ›å»ºå¤±è´¥
    this.errorStrategies.set('shadow_dom_failed', {
      fallback: 'css-namespace',
      action: (error, sandbox) => {
        console.warn('Shadow DOM åˆ›å»ºå¤±è´¥ï¼Œé™çº§åˆ° CSS å‘½åç©ºé—´', error);
        return new CSSNamespaceIsolation(sandbox.appName);
      }
    });
    
    // å†…å­˜ç›‘æ§å¤±è´¥
    this.errorStrategies.set('memory_monitoring_failed', {
      fallback: 'disable',
      action: (error, sandbox) => {
        console.warn('å†…å­˜ç›‘æ§å¤±è´¥ï¼Œç¦ç”¨å†…å­˜ç›‘æ§åŠŸèƒ½', error);
        sandbox.options.enableMemoryMonitoring = false;
        return null;
      }
    });
  }

  /**
   * å¤„ç†é”™è¯¯
   */
  handleError(errorType, error, sandbox) {
    const strategy = this.errorStrategies.get(errorType);
    
    if (!strategy) {
      console.error(`æœªçŸ¥é”™è¯¯ç±»å‹: ${errorType}`, error);
      throw error;
    }
    
    console.log(`ğŸ”„ æ‰§è¡Œé”™è¯¯å¤„ç†ç­–ç•¥: ${errorType} -> ${strategy.fallback}`);
    
    try {
      return strategy.action(error, sandbox);
    } catch (fallbackError) {
      console.error('é”™è¯¯å¤„ç†ç­–ç•¥æ‰§è¡Œå¤±è´¥', fallbackError);
      throw fallbackError;
    }
  }

  /**
   * æ³¨å†Œè‡ªå®šä¹‰é”™è¯¯ç­–ç•¥
   */
  registerStrategy(errorType, strategy) {
    this.errorStrategies.set(errorType, strategy);
  }
}
```

## æ€»ç»“

æœ¬æ–‡æä¾›äº†ä¸€å¥—å®Œæ•´çš„å¾®å‰ç«¯æ²™ç®±éš”ç¦»è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ï¼š

### ğŸ”§ **æ ¸å¿ƒåŠŸèƒ½**
- **JavaScript æ²™ç®±**ï¼šå¿«ç…§ã€ä»£ç†ã€åŸç”Ÿä¸‰ç§ç­–ç•¥
- **CSS æ ·å¼éš”ç¦»**ï¼šå‘½åç©ºé—´å’Œ Shadow DOM ä¸¤ç§æ–¹æ¡ˆ
- **èµ„æºç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šå®Œæ•´çš„èµ„æºè¿½è¸ªå’Œæ¸…ç†
- **å†…å­˜æ³„æ¼æ£€æµ‹**ï¼šå®æ—¶ç›‘æ§å’ŒæŠ¥å‘Š
- **é”™è¯¯å¤„ç†å’Œé™çº§**ï¼šå…¼å®¹æ€§ä¿éšœ

### ğŸ¯ **è®¾è®¡åŸåˆ™**
- **æ¸è¿›å¢å¼º**ï¼šä»åŸºç¡€éš”ç¦»åˆ°é«˜çº§åŠŸèƒ½
- **ç­–ç•¥å¯é€‰**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„éš”ç¦»ç­–ç•¥
- **æ€§èƒ½ä¼˜å…ˆ**ï¼šå»¶è¿ŸåŠ è½½å’Œæ™ºèƒ½æ¸…ç†
- **å¼€å‘å‹å¥½**ï¼šä¸°å¯Œçš„è°ƒè¯•å·¥å…·å’Œç›‘æ§

### ğŸš€ **ä½¿ç”¨å»ºè®®**
1. **å¼€å‘é˜¶æ®µ**ï¼šå¯ç”¨å®Œæ•´çš„ç›‘æ§å’Œè°ƒè¯•åŠŸèƒ½
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šé€‰æ‹©æ€§èƒ½æœ€ä¼˜çš„ç­–ç•¥ç»„åˆ
3. **å…¼å®¹æ€§è¦æ±‚é«˜**ï¼šä½¿ç”¨å¿«ç…§æ²™ç®±å’Œ CSS å‘½åç©ºé—´
4. **ä¸¥æ ¼éš”ç¦»éœ€æ±‚**ï¼šä½¿ç”¨åŸç”Ÿæ²™ç®±æˆ– Shadow DOM

è¿™å¥—æ–¹æ¡ˆå¯ä»¥æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„å¾®å‰ç«¯éš”ç¦»éœ€æ±‚ï¼Œç¡®ä¿åº”ç”¨é—´çš„å®Œå…¨ç‹¬ç«‹è¿è¡Œã€‚
